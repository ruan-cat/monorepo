# Changelog

`common-tools` Claude Code æ’ä»¶çš„æ‰€æœ‰é‡è¦å˜æ›´éƒ½å°†è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚

æœ¬æ–‡æ¡£æ ¼å¼åŸºäº [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/)ï¼Œ
é¡¹ç›®éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)ã€‚

## [0.5.0] - 2025-11-03

### Added

- **å®Œæ•´æ—¥å¿—è®°å½•æœºåˆ¶**: æ–°å¢è‡ªåŠ¨æ—¥å¿—è®°å½•ç³»ç»Ÿ
  - æ—¥å¿—ä½ç½®ï¼š`%TEMP%\claude-code-task-complete-notifier-logs\`ï¼ˆWindowsï¼‰æˆ– `/tmp/claude-code-task-complete-notifier-logs/`ï¼ˆLinux/Macï¼‰
  - æ—¥å¿—æ–‡ä»¶å‘½åï¼š`YYYY-MM-DD__HH-mm-ss__å·¥ä½œç›®å½•.log`
  - è®°å½•å†…å®¹ï¼šHook è¾“å…¥æ•°æ®ã€å¯¹è¯ä¸Šä¸‹æ–‡ã€Gemini promptã€å“åº”ã€æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
  - æ—¥å¿—å‡½æ•°ï¼š`log()` å‡½æ•°åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶

- **å¯¹è¯å†å²è§£æåŠŸèƒ½**: ä» `transcript_path` è¯»å–å¯¹è¯å†å²
  - æ”¯æŒ JSONL æ ¼å¼è§£æï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰
  - æå–æœ€è¿‘ 5 æ¡æ¶ˆæ¯çš„ç”¨æˆ·å’ŒåŠ©æ‰‹å†…å®¹
  - é™åˆ¶æ¯æ¡æ¶ˆæ¯ 500 å­—ç¬¦ï¼Œé¿å… prompt è¿‡é•¿
  - æ™ºèƒ½ç»„åˆæˆæœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡æ‘˜è¦

- **å¤šæ¨¡å‹é™çº§ç­–ç•¥**: å®ç°ä¸‰çº§æ¨¡å‹é€‰æ‹©æœºåˆ¶
  - çº§åˆ« 1ï¼š`gemini-2.5-flash`ï¼ˆ5 ç§’è¶…æ—¶ï¼Œå¿«é€Ÿå“åº”ï¼‰
  - çº§åˆ« 2ï¼š`gemini-2.5-pro`ï¼ˆ8 ç§’è¶…æ—¶ï¼Œé«˜è´¨é‡æ€»ç»“ï¼‰
  - çº§åˆ« 3ï¼šé»˜è®¤æ¨¡å‹ï¼ˆ5 ç§’è¶…æ—¶ï¼‰
  - é™çº§ç­–ç•¥ï¼šä½¿ç”¨å¯¹è¯ä¸Šä¸‹æ–‡å‰ 50 å­—ç¬¦

- **æ‰§è¡Œæ—¶é—´ç»Ÿè®¡**: è®°å½•æ¯ä¸ª Gemini è°ƒç”¨çš„æ‰§è¡Œæ—¶é—´
  - å¸®åŠ©åˆ†æå’Œä¼˜åŒ–æ¨¡å‹é€‰æ‹©
  - ç›‘æ§æ€§èƒ½è¡¨ç°

- **è¯¦ç»†åŠŸèƒ½æ–‡æ¡£**: æ–°å¢ `TASK_COMPLETE_NOTIFIER_README.md`
  - å®Œæ•´çš„é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆè¯´æ˜
  - æ¨¡å‹é€‰æ‹©å»ºè®®å’Œæ€§èƒ½å¯¹æ¯”
  - ä½¿ç”¨æ–¹æ³•å’Œè°ƒè¯•æŒ‡å—
  - ç¤ºä¾‹æ—¥å¿—å±•ç¤º

### Fixed

- **ğŸ æ ¸å¿ƒé—®é¢˜ä¿®å¤**: ä¿®å¤äº† Gemini æ€»ç»“æ€»æ˜¯è¿”å›"ä»»åŠ¡å·²å®Œæˆ"çš„æ ¹æœ¬é—®é¢˜
  - **é—®é¢˜åŸå› **ï¼šStop é’©å­ä¸åŒ…å« `tool_input` å­—æ®µ
  - **åŸå§‹ä»£ç **ï¼šé”™è¯¯åœ°å°è¯•ä» `data.tool_input?.description` æå–ä»»åŠ¡æè¿°
  - **å¯¼è‡´ç»“æœ**ï¼š`TASK_DESCRIPTION` å§‹ç»ˆä¸ºé»˜è®¤å€¼"ä»»åŠ¡"ï¼ŒGemini æ”¶åˆ°çš„ prompt è¿‡äºç®€å•
  - **è§£å†³æ–¹æ¡ˆ**ï¼šä» `transcript_path` è¯»å–å®Œæ•´å¯¹è¯å†å²å¹¶æå–æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡

- **å¯¹è¯ä¸Šä¸‹æ–‡æå–**: å®ç°æ­£ç¡®çš„æ•°æ®æå–é€»è¾‘
  - ä½¿ç”¨ Node.js è§£æ JSONL æ ¼å¼çš„ä¼šè¯å†å²
  - æå–ç”¨æˆ·æ¶ˆæ¯å’ŒåŠ©æ‰‹å“åº”çš„æ–‡æœ¬å†…å®¹
  - æ”¯æŒæ•°ç»„å’Œå­—ç¬¦ä¸²ä¸¤ç§å†…å®¹æ ¼å¼
  - è¿‡æ»¤ç©ºæ¶ˆæ¯å’Œæ— æ•ˆæ•°æ®

- **Gemini Prompt ä¼˜åŒ–**: æ”¹è¿›å‘é€ç»™ Gemini çš„ prompt
  - æä¾›å®é™…çš„å¯¹è¯å†…å®¹è€Œéç©ºæ´çš„"ä»»åŠ¡"
  - åŒ…å«æ˜ç¡®çš„è¾“å‡ºæ ¼å¼è¦æ±‚å’Œç¤ºä¾‹
  - æ¸…æ™°çš„å­—æ•°é™åˆ¶ï¼ˆ5-20 å­—ï¼‰
  - å¢å¼ºçš„ä¸Šä¸‹æ–‡æè¿°

### Changed

- **æ‘˜è¦é•¿åº¦è°ƒæ•´**: å°†æœ€å¤§é•¿åº¦ä» 20 å­—ç¬¦æ‰©å±•åˆ° 50 å­—ç¬¦
  - å…è®¸æ›´è¯¦ç»†çš„ä»»åŠ¡æè¿°
  - è¶…è¿‡ 50 å­—ç¬¦æ—¶è‡ªåŠ¨æˆªæ–­å¹¶æ·»åŠ  `...`

- **é”™è¯¯å¤„ç†å¢å¼º**: æ”¹è¿› Gemini è°ƒç”¨çš„é”™è¯¯å¤„ç†
  - ä½¿ç”¨ `2>&1` æ•è·é”™è¯¯è¾“å‡ºå¹¶è®°å½•åˆ°æ—¥å¿—
  - ä½¿ç”¨ `tee` åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶
  - æ£€æŸ¥ç»“æœé•¿åº¦åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•

- **è¶…æ—¶ç­–ç•¥ä¼˜åŒ–**: è°ƒæ•´ä¸åŒæ¨¡å‹çš„è¶…æ—¶æ—¶é—´
  - flash æ¨¡å‹ï¼š5 ç§’ï¼ˆç¬¦åˆå¿«é€Ÿå“åº”éœ€æ±‚ï¼‰
  - pro æ¨¡å‹ï¼š8 ç§’ï¼ˆç•™å‡ºæ›´å¤šæ—¶é—´ä¿è¯è´¨é‡ï¼‰
  - é»˜è®¤æ¨¡å‹ï¼š5 ç§’

### Technical Details

#### Stop é’©å­çš„å®é™…æ•°æ®æ ¼å¼

```json
{
	"session_id": "abc123",
	"transcript_path": "~/.claude/projects/.../session.jsonl",
	"permission_mode": "default",
	"hook_event_name": "Stop",
	"stop_hook_active": true
}
```

**é‡è¦å‘ç°**ï¼šStop é’©å­**ä¸åŒ…å«** `tool_input`ã€`cwd` æˆ– `conversationMessages` å­—æ®µã€‚

#### å¯¹è¯å†å²æ–‡ä»¶æ ¼å¼

transcript_path æŒ‡å‘çš„ JSONL æ–‡ä»¶æ ¼å¼ï¼š

```jsonl
{"role":"user","content":[{"type":"text","text":"ç”¨æˆ·æ¶ˆæ¯"}]}
{"role":"assistant","content":[{"type":"text","text":"åŠ©æ‰‹å“åº”"}]}
```

#### æ¨¡å‹æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹             | å¹³å‡å“åº”æ—¶é—´ | æ€»ç»“è´¨é‡ | æ¨èåœºæ™¯               |
| ---------------- | ------------ | -------- | ---------------------- |
| gemini-2.5-flash | 1-3 ç§’       | è‰¯å¥½     | å¿«é€Ÿé€šçŸ¥ï¼Œç®€å•ä»»åŠ¡     |
| gemini-2.5-pro   | 3-6 ç§’       | ä¼˜ç§€     | å¤æ‚ä»»åŠ¡ï¼Œéœ€è¦ç²¾å‡†è¡¨è¾¾ |

**å®æ–½ç­–ç•¥**ï¼šä¼˜å…ˆä½¿ç”¨ flashï¼ˆé€Ÿåº¦ï¼‰ï¼Œå¤±è´¥æ—¶åˆ‡æ¢ proï¼ˆè´¨é‡ï¼‰ï¼Œç¡®ä¿åœ¨ 5-8 ç§’å†…å®Œæˆã€‚

### Breaking Changes

æ— ç ´åæ€§å˜æ›´ã€‚æ‰€æœ‰æ”¹è¿›éƒ½å‘åå…¼å®¹ã€‚

### Migration Guide

æ— éœ€è¿ç§»ã€‚ç°æœ‰ç”¨æˆ·æ›´æ–°åˆ° 0.5.0 åå°†è‡ªåŠ¨äº«å—æ”¹è¿›çš„æ€»ç»“åŠŸèƒ½ã€‚

### Debugging

å¦‚æœé‡åˆ°æ€»ç»“é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

```powershell
# Windows
cd $env:TEMP\claude-code-task-complete-notifier-logs
Get-Content (Get-ChildItem | Sort-Object LastWriteTime -Descending | Select-Object -First 1).FullName

# Linux/Mac
tail -f /tmp/claude-code-task-complete-notifier-logs/$(ls -t /tmp/claude-code-task-complete-notifier-logs | head -1)
```

æ—¥å¿—åŒ…å«ï¼š

1. Hook è¾“å…¥æ•°æ®ï¼ˆå®Œæ•´ JSONï¼‰
2. æå–çš„å¯¹è¯ä¸Šä¸‹æ–‡
3. å‘é€ç»™ Gemini çš„ prompt
4. Gemini çš„åŸå§‹å“åº”
5. æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
6. æœ€ç»ˆé€šçŸ¥ç»“æœ

### References

- è¯¦ç»†è¯´æ˜ï¼š[scripts/TASK_COMPLETE_NOTIFIER_README.md](./scripts/TASK_COMPLETE_NOTIFIER_README.md)
- å®˜æ–¹æ–‡æ¡£ï¼š[Claude Code Hooks Reference](https://docs.claude.com/en/docs/claude-code/hooks)

## [0.4.1] - 2025-11-03

### Fixed

- **é’©å­é‡å¤æ‰§è¡Œé—®é¢˜**: ä¿®å¤äº†æ’ä»¶é’©å­é‡å¤è¿è¡Œä¸¤æ¬¡çš„ä¸¥é‡ bug
  - é—®é¢˜åŸå› ï¼š`plugin.json` ä¸­ `hooks` å­—æ®µä½¿ç”¨äº†ä¸å—æ”¯æŒçš„æ•°ç»„æ ¼å¼ `["./hooks/hooks.json"]`
  - ä¿®å¤æ–¹æ¡ˆï¼šå°† `hooks` å­—æ®µæ”¹ä¸ºå®˜æ–¹æ”¯æŒçš„å­—ç¬¦ä¸²æ ¼å¼ `"./hooks/hooks.json"`
  - å½±å“èŒƒå›´ï¼šæ‰€æœ‰é’©å­äº‹ä»¶ï¼ˆSessionStartã€UserPromptSubmitã€PreToolUseã€PostToolUseã€Stopã€SessionEndã€SubagentStopï¼‰
  - å‚è€ƒæ–‡æ¡£ï¼š[Claude Code æ’ä»¶å‚è€ƒæ–‡æ¡£ - hooks å­—æ®µå®šä¹‰](https://docs.claude.com/en/docs/claude-code/plugins-reference.md)
  - è¯¦ç»†åˆ†æï¼šå‚è§ `docs/reports/claude-code-hooks-duplicate-execution-issue.md`

### Technical Details

ä¿®å¤å‰çš„é…ç½®ï¼š

```json
{
	"hooks": ["./hooks/hooks.json"] // âŒ ä¸æ”¯æŒçš„æ•°ç»„æ ¼å¼
}
```

ä¿®å¤åçš„é…ç½®ï¼š

```json
{
	"hooks": "./hooks/hooks.json" // âœ… æ­£ç¡®çš„å­—ç¬¦ä¸²æ ¼å¼
}
```

**å½±å“**ï¼šä¿®å¤åï¼Œæ¯ä¸ªé’©å­äº‹ä»¶åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè§£å†³äº†ä¹‹å‰å‡ºç°çš„ `Running PostToolUse hooksâ€¦ (1/2 done)` çš„é—®é¢˜ã€‚

## [0.4.0] - 2025-11-03

### Added

- **å®Œæ•´é’©å­ç³»ç»Ÿ**: å®ç°äº†åŸºäº Claude Code å„ä¸ªé’©å­äº‹ä»¶çš„é€šçŸ¥ç³»ç»Ÿ
  - `Stop`: ä»»åŠ¡å®Œæˆæ—¶è§¦å‘é€šçŸ¥ï¼Œæ”¯æŒ Gemini AI æ™ºèƒ½ç”Ÿæˆä»»åŠ¡æ‘˜è¦
  - `SessionStart`: ä¼šè¯å¼€å§‹æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `SessionEnd`: ä¼šè¯ç»“æŸæ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `UserPromptSubmit`: ç”¨æˆ·æäº¤æ¶ˆæ¯æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `PreToolUse`: å·¥å…·ä½¿ç”¨å‰çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `PostToolUse`: å·¥å…·ä½¿ç”¨åçš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `SubagentStop`: å­ä»£ç†åœæ­¢æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥

- **é€šçŸ¥åŠŸèƒ½**: é›†æˆ `@ruan-cat/claude-notifier` åŒ…æä¾›é€šçŸ¥èƒ½åŠ›
  - `task-complete`: ä»»åŠ¡å®Œæˆé€šçŸ¥
  - `check-and-notify`: å®šæ—¶æ£€æŸ¥å¹¶å‘é€é€šçŸ¥
  - æ”¯æŒ Gemini AI æ™ºèƒ½æ€»ç»“ä»»åŠ¡å†…å®¹

- **è„šæœ¬æ”¯æŒ**: æ–°å¢ `task-complete-notifier.sh` è„šæœ¬
  - ä½¿ç”¨ç¯å¢ƒå˜é‡ `CLAUDE_PLUGIN_ROOT` å®šä½æ’ä»¶ç›®å½•
  - æä¾›æ›´çµæ´»çš„é€šçŸ¥è§¦å‘æœºåˆ¶

### Changed

- å°†æ‰€æœ‰é€šçŸ¥é’©å­æ•´åˆåˆ° `Stop` äº‹ä»¶ä¸­ï¼Œç»Ÿä¸€ç®¡ç†

### Fixed

- ä¿®å¤äº† `task-complete-notifier.sh` è„šæœ¬ç¼ºå¤± `CLAUDE_PROJECT_DIR` ç¯å¢ƒå˜é‡çš„é—®é¢˜

## Previous Versions

### [0.3.x] - 2025-10-22 ~ 2025-11-01

æ—©æœŸç‰ˆæœ¬åŒ…å«äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **Commands**:
  - `markdown-title-order`: è®¾ç½®å¹¶ç»´æŠ¤ Markdown æ–‡æ¡£çš„æ ‡é¢˜åºå·
  - `close-window-port`: å…³é—­æŒ‡å®šç«¯å£çš„çª—å£è¿›ç¨‹

- **Agents**:
  - `format-markdown`: æ ¼å¼åŒ– Markdown æ–‡æ¡£çš„ä¸“ç”¨å­ä»£ç†

- **æ’ä»¶æ¶æ„**: åŸºäº [claude-code-marketplace](https://github.com/ananddtyagi/claude-code-marketplace) çš„ä»£ç ç»“æ„è®¾è®¡

---

## ç»´æŠ¤è¯´æ˜

### æŠ¥å‘Šé—®é¢˜

å¦‚æœæ‚¨åœ¨ä½¿ç”¨æ’ä»¶æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹è¯¦ç»†çš„é—®é¢˜åˆ†ææŠ¥å‘Šï¼š`docs/reports/claude-code-hooks-duplicate-execution-issue.md`
2. åœ¨ GitHub ä»“åº“æäº¤ Issueï¼š[ruan-cat/monorepo](https://github.com/ruan-cat/monorepo/issues)

### ç‰ˆæœ¬å‡çº§

æœ¬æ’ä»¶éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼š

- **Major (x.0.0)**: ç ´åæ€§å˜æ›´
- **Minor (0.x.0)**: æ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- **Patch (0.0.x)**: Bug ä¿®å¤ï¼Œå‘åå…¼å®¹

### æ›´æ–°æ’ä»¶

å¦‚æœæ‚¨å·²å®‰è£…æ­¤æ’ä»¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```bash
# æ›´æ–°æ’ä»¶å¸‚åœº
/plugin marketplace update ruan-cat/monorepo

# æˆ–é‡æ–°å®‰è£…æ’ä»¶
/plugin uninstall common-tools
/plugin install common-tools@ruan-cat-tools
```

---

**ç»´æŠ¤è€…**: ruan-cat (1219043956@qq.com)

**ä»“åº“**: [https://github.com/ruan-cat/monorepo](https://github.com/ruan-cat/monorepo)

**è®¸å¯è¯**: MIT
