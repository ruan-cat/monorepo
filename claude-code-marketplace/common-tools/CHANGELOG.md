# Changelog

`common-tools` Claude Code æ’ä»¶çš„æ‰€æœ‰é‡è¦å˜æ›´éƒ½å°†è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚

æœ¬æ–‡æ¡£æ ¼å¼åŸºäº [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/)ï¼Œ
é¡¹ç›®éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)ã€‚

## [1.0.0] - 2026-02-03

### Breaking Changes

âš ï¸ **é‡å¤§å˜æ›´**: Gemini æ™ºèƒ½æ€»ç»“åŠŸèƒ½ç°é»˜è®¤å…³é—­

æœ¬ç‰ˆæœ¬å°† Gemini AI æ™ºèƒ½æ€»ç»“åŠŸèƒ½ä»é»˜è®¤å¯ç”¨æ”¹ä¸ºé»˜è®¤ç¦ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç ´åæ€§å˜æ›´ã€‚

**å˜æ›´åŸå› **ï¼š

- å‡å°‘å¯¹å¤–éƒ¨ API çš„ä¾èµ–
- æå‡ä»»åŠ¡å®Œæˆé€šçŸ¥çš„å“åº”é€Ÿåº¦
- é™ä½ç½‘ç»œè¯·æ±‚å¤±è´¥å¯¼è‡´çš„é€šçŸ¥å»¶è¿Ÿ

**è¿ç§»æŒ‡å—**ï¼š

å¦‚éœ€ç»§ç»­ä½¿ç”¨ Gemini æ™ºèƒ½æ€»ç»“åŠŸèƒ½ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export GEMINI_SUMMARY_ENABLED=true
```

### Changed

- **Gemini æ€»ç»“åŠŸèƒ½å¼€å…³**: æ–°å¢ `ENABLE_GEMINI_SUMMARY` é…ç½®å¼€å…³
  - é»˜è®¤å€¼ï¼š`false`ï¼ˆå…³é—­ Gemini æ€»ç»“ï¼‰
  - å¯é€šè¿‡ç¯å¢ƒå˜é‡ `GEMINI_SUMMARY_ENABLED=true` å¯ç”¨
  - å¼€å…³ä½ç½®ï¼š`scripts/task-complete-notifier.sh:8-11`

- **é€šçŸ¥æ¶ˆæ¯ä¼˜åŒ–**: ç®€åŒ–ä»»åŠ¡å®Œæˆé€šçŸ¥çš„æ¶ˆæ¯å†…å®¹
  - ä¿®æ”¹å‰ï¼š`égeminiæ€»ç»“ï¼šä»»åŠ¡å®Œæˆ`
  - ä¿®æ”¹åï¼š`å·²å®Œæˆä»»åŠ¡`
  - æ›´ç®€æ´ã€æ›´ä¸“ä¸šçš„é€šçŸ¥æ–‡æ¡ˆ

### Technical Details

#### å¼€å…³å®ç°æœºåˆ¶

```bash
# scripts/task-complete-notifier.sh

# ====== Gemini æ€»ç»“åŠŸèƒ½å¼€å…³ ======
# è®¾ç½®ä¸º true å¯ç”¨ Gemini AI æ™ºèƒ½æ€»ç»“ï¼Œè®¾ç½®ä¸º false ç¦ç”¨
# å¯é€šè¿‡ç¯å¢ƒå˜é‡ GEMINI_SUMMARY_ENABLED è¦†ç›–æ­¤è®¾ç½®
ENABLE_GEMINI_SUMMARY="${GEMINI_SUMMARY_ENABLED:-false}"
```

#### è¡Œä¸ºå¯¹æ¯”

| åœºæ™¯        | v0.15.0                      | v1.0.0                               |
| ----------- | ---------------------------- | ------------------------------------ |
| é»˜è®¤è¡Œä¸º    | è°ƒç”¨ Gemini API ç”Ÿæˆæ™ºèƒ½æ‘˜è¦ | ç›´æ¥æ˜¾ç¤º"å·²å®Œæˆä»»åŠ¡"                 |
| ç«‹å³é€šçŸ¥    | "é gemini æ€»ç»“ï¼šä»»åŠ¡å®Œæˆ"   | "å·²å®Œæˆä»»åŠ¡"                         |
| å¯ç”¨ Gemini | é»˜è®¤å¯ç”¨                     | éœ€è®¾ç½® `GEMINI_SUMMARY_ENABLED=true` |
| ç¦ç”¨ Gemini | éœ€ä¿®æ”¹è„šæœ¬                   | é»˜è®¤ç¦ç”¨                             |

### References

- ç›¸å…³è„šæœ¬ï¼š`scripts/task-complete-notifier.sh`
- ç›¸å…³é…ç½®ï¼šç¯å¢ƒå˜é‡ `GEMINI_SUMMARY_ENABLED`

## [0.15.0] - 2026-02-03

### Changed

- **Skill é‡åš**: `openspec` - OpenSpec è§„èŒƒé©±åŠ¨å¼€å‘åŠ©æ‰‹æŠ€èƒ½ (v1.0.0)
  - **å®Œå…¨é‡å†™æŠ€èƒ½æ–‡æ¡£**ï¼Œä» `@org-hex/openspec-chinese` å·¥å…·æ–‡æ¡£å‡çº§ä¸ºåŸºäº OPSX å·¥ä½œæµçš„ AI è¾…åŠ©ç¼–ç¨‹æ¡†æ¶
  - **æ ¸å¿ƒç†å¿µå˜æ›´**ï¼šä»å·¥å…·ä½¿ç”¨æŒ‡å—è½¬å˜ä¸ºè§„èŒƒé©±åŠ¨å¼€å‘æ¡†æ¶
  - **æ–°å¢æ ¸å¿ƒåŸåˆ™**ï¼š
    - æµåŠ¨è€ŒéåƒµåŒ– - éšæ—¶å¤„ç†ä»»ä½•å·¥ä»¶ï¼Œæ— é˜¶æ®µé—¨æ§
    - è¿­ä»£è€Œéç€‘å¸ƒ - è¾¹æ„å»ºè¾¹å®Œå–„ç†è§£
    - ç®€å•è€Œéå¤æ‚ - æœ€å°åŒ–è®¾ç½®å’Œä»ªå¼
    - æ£•åœ°ä¼˜å…ˆ - Delta æ–¹å¼ä¿®æ”¹ç°æœ‰ç³»ç»Ÿ
  - **æ–°å¢å·¥ä½œæµæ¨¡å¼**ï¼š
    - å¿«é€ŸåŠŸèƒ½æµï¼š`/opsx:new â†’ /opsx:ff â†’ /opsx:apply â†’ /opsx:verify â†’ /opsx:archive`
    - æ¢ç´¢å¼æµç¨‹ï¼š`/opsx:explore â†’ /opsx:new â†’ /opsx:continue â†’ ... â†’ /opsx:apply`
    - å¢é‡å¼æµç¨‹ï¼š`/opsx:new â†’ /opsx:continue (é‡å¤) â†’ /opsx:apply â†’ /opsx:archive`
  - **æ–°å¢å·¥ä»¶ç³»ç»Ÿè¯´æ˜**ï¼š
    - é»˜è®¤ Schema: spec-driven
    - å·¥ä»¶ä¾èµ–å…³ç³»ï¼šproposal â†’ specs â†’ design â†’ tasks â†’ implement
    - å·¥ä»¶çŠ¶æ€è½¬æ¢ï¼šBLOCKED â†’ READY â†’ DONE
  - **æ–°å¢ Delta Specs æ ¼å¼è§„èŒƒ**ï¼šADDED/MODIFIED/REMOVED æ ‡è®°ç³»ç»Ÿ
  - **æ–°å¢é¡¹ç›®é…ç½®è¯´æ˜**ï¼šconfig.yaml é…ç½®é¡¹å’Œ Schema ä¼˜å…ˆçº§
  - **æ–°å¢è‡ªå®šä¹‰ Schema åˆ›å»ºæŒ‡å—**
  - **æ–°å¢éªŒè¯å‘½ä»¤è¯´æ˜**ï¼šCompleteness/Correctness/Coherence ä¸‰ç»´åº¦æ£€æŸ¥
  - **æ–°å¢æ‰§è¡Œé•¿ä»»åŠ¡æ³¨æ„äº‹é¡¹**ï¼šä¸»ä»ä»£ç†è°ƒåº¦ã€å¹¶è¡Œå­ä»£ç†ç­‰
  - **æ–°å¢æ•…éšœæ’é™¤æŒ‡å—**
  - **æ›´æ–°æ–œæ å‘½ä»¤åˆ—è¡¨**ï¼šå®Œæ•´çš„ `/opsx:*` å‘½ä»¤é€ŸæŸ¥è¡¨
  - **æ›´æ–° CLI å‘½ä»¤å‚è€ƒ**

### Technical Details

#### openspec æŠ€èƒ½ v1.0.0 ä¸»è¦å˜æ›´

**v0.9.0 ç‰ˆæœ¬**ï¼ˆæ—§ç‰ˆï¼‰ï¼š

- é¢å‘ `@org-hex/openspec-chinese` CLI å·¥å…·çš„ä½¿ç”¨æŒ‡å—
- ä¾§é‡äºå‘½ä»¤è¡Œæ“ä½œå’Œè§„æ ¼æ–‡æ¡£æ ¼å¼

**v1.0.0 ç‰ˆæœ¬**ï¼ˆæ–°ç‰ˆï¼‰ï¼š

- å®Œæ•´çš„è§„èŒƒé©±åŠ¨å¼€å‘æ¡†æ¶æ–‡æ¡£
- åŒ…å«å·¥ä½œæµã€å·¥ä»¶ç³»ç»Ÿã€é…ç½®å’Œè‡ªå®šä¹‰ Schema
- æ›´å¼ºè°ƒå¼€å‘ç†å¿µå’Œæœ€ä½³å®è·µ
- ä¸ OpenSpec å®˜æ–¹ OPSX å·¥ä½œæµä¿æŒä¸€è‡´

### References

- OpenSpec ä»“åº“: https://github.com/Fission-AI/OpenSpec
- OPSX å·¥ä½œæµæ–‡æ¡£: https://github.com/Fission-AI/OpenSpec/blob/main/docs/opsx.md

## [0.14.0] - 2026-02-01

### Added

- **æ–°å¢ Skill**: `git-commit` - Git æäº¤åŠ©æ‰‹æŠ€èƒ½
  - ä½ç½®ï¼š`skills/git-commit/`
  - æ ¸å¿ƒåŠŸèƒ½ï¼š
    - åˆ›å»ºé«˜è´¨é‡çš„ git æäº¤ï¼Œå¼•å¯¼ç”¨æˆ·å®¡æŸ¥ã€æš‚å­˜å’Œæ‹†åˆ†å˜æ›´
    - å¼ºåˆ¶ä½¿ç”¨ Conventional Commits è§„èŒƒï¼Œå¹¶æ”¯æŒ Emoji
    - æäº¤ä¿¡æ¯å¿…é¡»ä½¿ç”¨ä¸­æ–‡ç¼–å†™
    - è‡ªåŠ¨æŸ¥é˜…é¡¹ç›®çº§ `commit-types.ts` é…ç½®ï¼Œç¡®ä¿ Emoji å’Œ Type è§„èŒƒä¸€è‡´
  - åŒ…å«æ–‡ä»¶ï¼š
    - `SKILL.md` - æŠ€èƒ½ä¸»æ–‡ä»¶ï¼Œå®šä¹‰å·¥ä½œæµç¨‹å’Œè§„èŒƒ
    - `references/commit-message-template.md` - æäº¤ä¿¡æ¯æ¨¡æ¿å’Œ Emoji å¯¹ç…§è¡¨
  - æ¥æºè¯´æ˜ï¼šè¯¥æŠ€èƒ½æ˜¯ `agent-toolkit/skills/commit-work` çš„ä¸­æ–‡æ”¹å†™ç‰ˆï¼Œé€‚åº”æœ¬åœ°åŒ–éœ€æ±‚

### References

- Agent Skills è§„èŒƒæ–‡æ¡£: https://agentskills.io/specification#metadata-field
- Claude Code Skills æ–‡æ¡£: https://code.claude.com/docs/zh-CN/skills

## [0.13.4] - 2026-02-01

### Added

- **Skills æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†**: ä¸ºæ‰€æœ‰ skills æ–‡æ¡£æ·»åŠ  `metadata.version` å­—æ®µ
  - éµå¾ª Agent Skills è§„èŒƒï¼ˆhttps://agentskills.io/specification#metadata-fieldï¼‰
  - ç‰ˆæœ¬å·ä¸æ’ä»¶å•†åŸç‰ˆæœ¬ä¿æŒåŒæ­¥
  - æ¶‰åŠçš„ skills æ–‡æ¡£ï¼š
    - `skills/openspec/SKILL.md`
    - `skills/init-prettier-git-hooks/SKILL.md`
    - `skills/init-claude-code-statusline/SKILL.md`
    - `skills/init-ai-md/SKILL.md`
    - `skills/nitro-api-development/SKILL.md`

### Changed

- **ç‰ˆæœ¬å‡çº§æ“ä½œè§„èŒƒå¢å¼º**: æ›´æ–° `claude-code-marketplace` é¡¹ç›®çº§åˆ«æŠ€èƒ½æ–‡æ¡£
  - æ–°å¢"Skills æ–‡æ¡£çš„ metadata.version å­—æ®µ"ç« èŠ‚ï¼Œæ˜ç¡®éœ€è¦æ›´æ–°çš„ skills æ–‡æ¡£åˆ—è¡¨
  - æ›´æ–°"å‡çº§æµç¨‹æ­¥éª¤"ï¼Œå¢åŠ åŒæ­¥æ›´æ–° skills æ–‡æ¡£ç‰ˆæœ¬å·çš„è¦æ±‚
  - æ›´æ–°"éªŒè¯ä¸€è‡´æ€§"æ­¥éª¤ï¼Œå¢åŠ  skills æ–‡æ¡£ç‰ˆæœ¬å·ä¸€è‡´æ€§æ£€æŸ¥
  - æ›´æ–°ç¤ºä¾‹ï¼Œå±•ç¤ºå®Œæ•´çš„ç‰ˆæœ¬å‡çº§æµç¨‹
  - æ›´æ–°æ³¨æ„äº‹é¡¹ï¼Œå¼ºè°ƒ skills æ–‡æ¡£åŒæ­¥çš„é‡è¦æ€§

### References

- Agent Skills è§„èŒƒæ–‡æ¡£: https://agentskills.io/specification#metadata-field
- Claude Code Skills æ–‡æ¡£: https://code.claude.com/docs/zh-CN/skills

## [0.13.3] - 2026-01-28

### Changed

- **Hooks ä¼˜åŒ–**: è¿›ä¸€æ­¥ç²¾ç®€é’©å­é…ç½®
  - ç§»é™¤äº† `UserPromptSubmit` ä¸­çš„ `claude-notifier check-and-notify` è°ƒç”¨
  - **åŸå› **: æ·±åº¦åˆ†ææ—¥å¿—å‘ç°ï¼Œåœ¨ Gemini ç­‰æ¨¡å‹ä¸‹ï¼Œ`UserPromptSubmit` ä¸ `Stop` äº‹ä»¶ä¹‹é—´å­˜åœ¨ç«æ€æ¡ä»¶ã€‚å½“ç”¨æˆ·é«˜é¢‘äº¤äº’æ—¶ï¼Œä»»åŠ¡æ¸…ç†è„šæœ¬å°šæœªæ‰§è¡Œå®Œæ¯•ï¼Œä¸‹ä¸€æ¬¡äº¤äº’çš„ `UserPromptSubmit` å°±ä¼šè§¦å‘ `check-and-notify`ï¼Œå¯¼è‡´å…¶è¯»å–åˆ°æ—§çš„ä»»åŠ¡æ–‡ä»¶å¹¶è¯¯æŠ¥"é•¿ä»»åŠ¡å·²è¿è¡Œ"ã€‚ç§»é™¤æ­¤æ£€æŸ¥ç‚¹å½»åº•è§£å†³äº†"æ—¶é•¿è®¡æ•°é”™è¯¯"å’Œ"é¢‘ç¹é€šçŸ¥"çš„é—®é¢˜ï¼Œä»…ä¿ç•™ `SessionStart` å’Œ `SessionEnd` ä½œä¸ºå¿…è¦çš„å®šæ—¶æ£€æŸ¥ç‚¹ã€‚

## [0.13.2] - 2026-01-28

### Changed

- **Hooks ä¼˜åŒ–**: ç§»é™¤äº† `PreToolUse` é’©å­
  - ç§»é™¤äº†åœ¨æ¯æ¬¡å·¥å…·è°ƒç”¨å‰æ‰§è¡Œ `claude-notifier check-and-notify` çš„é…ç½®
  - **åŸå› **: åœ¨ä½¿ç”¨ Gemini ç­‰æ¨¡å‹æ—¶ï¼Œé«˜é¢‘çš„å·¥å…·è°ƒç”¨ä¼šå¯¼è‡´é’©å­è¢«é¢‘ç¹è§¦å‘ï¼Œäº§ç”Ÿå¤§é‡å¹²æ‰°æ€§çš„ "Running PreToolUse hooks..." æç¤ºï¼Œä¸”è¯¥æ£€æŸ¥åœ¨ `UserPromptSubmit` å’Œ `SessionStart` ä¸­å·²æœ‰è¦†ç›–ï¼Œç§»é™¤åä¸å½±å“å®šæ—¶æé†’åŠŸèƒ½ï¼Œä½†èƒ½æ˜¾è‘—æå‡äº¤äº’ä½“éªŒã€‚

### Fixed

- **ä»»åŠ¡æ¸…ç†é€»è¾‘å¢å¼º**: ä¼˜åŒ– `task-complete-notifier.sh` ä¸­çš„ä»»åŠ¡åˆ é™¤é€»è¾‘
  - æ”¹è¿›äº† Monorepo æ ¹ç›®å½•çš„æŸ¥æ‰¾ç®—æ³•ï¼Œä¼˜å…ˆä½¿ç”¨ `CLAUDE_PROJECT_DIR` ç¯å¢ƒå˜é‡
  - å¢åŠ äº†æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œå¸®åŠ©æ’æŸ¥ä»»åŠ¡æ— æ³•åˆ é™¤å¯¼è‡´çš„ "æ—¶é•¿è®¡æ•°é”™è¯¯" é—®é¢˜
  - è§£å†³äº†åœ¨ Gemini æ¨¡å‹ä¸‹å¯èƒ½å› è·¯å¾„è§£æå¤±è´¥å¯¼è‡´ä»»åŠ¡æ–‡ä»¶æ®‹ç•™ï¼Œè¿›è€Œå¼•å‘é€šçŸ¥æ··ä¹±çš„é—®é¢˜

## [0.13.1] - 2026-01-28

### Added

- **çŠ¶æ€æ å¢å¼º**: çŠ¶æ€æ è„šæœ¬å¢åŠ äº†æ–°çš„è®¡è´¹å­—æ®µç»Ÿè®¡
  - åœ¨ `init-claude-code-statusline` æŠ€èƒ½çš„ `statusline.sh` æ¨¡æ¿ä¸­
  - æ–°å¢è®¡è´¹ç»Ÿè®¡æ˜¾ç¤ºå—ï¼Œå¸®åŠ©ç”¨æˆ·æ›´ç›´è§‚åœ°ç›‘æ§ API ä½¿ç”¨æˆæœ¬

## [0.13.0] - 2026-01-27

### Added

- **æ–°å¢ Skill**: `nitro-api-development` - Nitro v3 æ¥å£å¼€å‘æŠ€èƒ½è§„èŒƒ
  - ä½ç½®ï¼š`skills/nitro-api-development/`
  - ç”¨äºæŒ‡å¯¼ä½¿ç”¨ Nitro v3 æ¡†æ¶ç¼–å†™æœåŠ¡ç«¯æ¥å£ï¼ŒåŒ…æ‹¬é¡¹ç›®åˆå§‹åŒ–ã€é…ç½®ã€æ¥å£ç¼–å†™è§„èŒƒç­‰å®Œæ•´æµç¨‹
  - é€‚ç”¨åœºæ™¯ï¼š
    - çº¯åç«¯ Nitro é¡¹ç›®åˆå§‹åŒ–
    - Vite é¡¹ç›®å…¨æ ˆåŒ–ï¼ˆèµ‹äºˆ Vite é¡¹ç›®æœåŠ¡ç«¯èƒ½åŠ›ï¼‰
    - æ¥å£å¼€å‘ä¸ç»´æŠ¤
  - æ ¸å¿ƒè§„èŒƒï¼š
    - å¯¼å…¥æ¥æºå¿…é¡»æ˜¯ `nitro/h3` è€Œé `h3`
    - ä½¿ç”¨ `defineHandler` è€Œé `defineEventHandler`
    - ç»Ÿä¸€çš„å“åº”æ ¼å¼ `{ success, message, data }`
  - åŒ…å«ä¸‰ä¸ªæ–‡æ¡£ï¼š
    - `SKILL.md` - ä¸»æŠ€èƒ½è§„èŒƒæ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„å¼€å‘è§„èŒƒå’Œæ£€æŸ¥æ¸…å•
    - `templates.md` - é¡¹ç›®åˆå§‹åŒ–ä»£ç æ¨¡æ¿é›†åˆ
    - `reference.md` - å‡½æ•°é€ŸæŸ¥ã€é…ç½®é€‰é¡¹å’Œå¸¸ç”¨ç±»å‹å‚è€ƒæ‰‹å†Œ

### References

- Nitro v3 å®˜æ–¹æ–‡æ¡£: https://v3.nitro.build/

## [0.12.0] - 2026-01-27

### Changed

- **Skill é‡å¤§å¢å¼º**: `init-ai-md` - AI è®°å¿†æ–‡ä»¶åˆå§‹åŒ–å’Œå¢é‡æ›´æ–°æŠ€èƒ½
  - **æ–°å¢äº¤äº’é€‰æ‹©åŠŸèƒ½**ï¼š
    - æ–°å¢æ­¥éª¤ 2ã€Œæ‰«æåˆ†æã€ï¼šæ‰«æç›®æ ‡æ–‡ä»¶çš„äºŒçº§æ ‡é¢˜ï¼Œå»ºç«‹ç°å­˜è®°å¿†é¡¹æ¸…å•ï¼›æ‰«æ templates ç›®å½•ï¼Œå»ºç«‹å¯ç”¨è®°å¿†é¡¹æ¸…å•
    - æ–°å¢æ­¥éª¤ 3ã€Œäº¤äº’é€‰æ‹©ã€ï¼šä½¿ç”¨ `AskUserQuestion` å·¥å…·çš„ `multiSelect: true` æ¨¡å¼ï¼Œè®©ç”¨æˆ·é€‰æ‹©éœ€è¦å¤„ç†çš„è®°å¿†é¡¹
    - é€‰é¡¹çŠ¶æ€æ ‡æ³¨ï¼š`[ç¼ºå¤±]`ï¼ˆç›®æ ‡æ–‡ä»¶ä¸­ä¸å­˜åœ¨ï¼‰ã€`[éœ€æ›´æ–°]`ï¼ˆå­˜åœ¨ä½†å†…å®¹ä¸å®Œæ•´ï¼‰ã€`[å·²å®Œæ•´]`ï¼ˆå†…å®¹ä¸€è‡´ï¼‰
  - **æ”¹è¿›å·®å¼‚å¯¹æ¯”ç­–ç•¥**ï¼š
    - å°†åŸæ¥çš„ã€Œæ™ºèƒ½åˆå¹¶ç­–ç•¥ã€æ”¹ä¸ºã€Œå·®å¼‚å¯¹æ¯”ä¸å¢é‡è¡¥å…¨ã€
    - é€è¡Œå¯¹æ¯”åŸåˆ™ï¼šæ·±åº¦é˜…è¯»å¹¶é€è¡Œ/é€æ®µè½å¯¹æ¯”æ–‡æœ¬å·®å¼‚
    - è¯†åˆ«å·®å¼‚ç±»å‹ï¼šç¼ºå¤±è¡Œã€ç¼ºå¤±æ®µè½ã€ç¼ºå¤±å­æ ‡é¢˜ã€å†…å®¹å·®å¼‚
    - å¢é‡è¡¥å…¨ç­–ç•¥ï¼šä»…è¡¥å…¨ç¼ºå¤±å†…å®¹ï¼Œä¿æŒç”¨æˆ·è‡ªå®šä¹‰å†…å®¹ä¸å˜
  - **æ–°å¢æ ¸å¿ƒåŸåˆ™**ï¼š
    - äº¤äº’ä¼˜å…ˆï¼šå¤„ç†å‰å¿…é¡»ä¸ç”¨æˆ·äº¤äº’ç¡®è®¤ï¼Œä¸å¾—è‡ªåŠ¨å…¨é‡å¤„ç†
    - å¢é‡è¡¥å…¨ï¼šä»…è¡¥å…¨ç¼ºå¤±å†…å®¹ï¼Œä¸å…¨é‡æ›¿æ¢
    - ä¿æŠ¤è‡ªå®šä¹‰ï¼šç”¨æˆ·è‡ªå®šä¹‰å†…å®¹ä¸å¾—è¢«è¦†ç›–
    - ç¦æ­¢è„šæœ¬ï¼šä¸å¾—ä½¿ç”¨ä»»ä½•è„šæœ¬è¿›è¡Œæ‰¹å¤„ç†
  - **æ–°å¢ç¦æ­¢äº‹é¡¹æ¸…å•**ï¼š
    - ç¦æ­¢æœªç»ç”¨æˆ·é€‰æ‹©ç›´æ¥å¤„ç†æ‰€æœ‰è®°å¿†é¡¹
    - ç¦æ­¢ä½¿ç”¨ Python/TypeScript/Shell ç­‰è„šæœ¬æ‰¹é‡å¤„ç†
    - ç¦æ­¢ä¸€è‚¡è„‘å¤åˆ¶ç²˜è´´æ•´ä¸ªæ¨¡æ¿æ–‡ä»¶å†…å®¹
    - ç¦æ­¢è¦†ç›–ç”¨æˆ·åœ¨ CLAUDE.md ä¸­çš„è‡ªå®šä¹‰å†…å®¹
    - ç¦æ­¢è·³è¿‡äº¤äº’é€‰æ‹©æ­¥éª¤ç›´æ¥æ‰§è¡Œæ›´æ–°
  - **æ–°å¢æ‰§è¡Œç¤ºä¾‹**ï¼šåœºæ™¯ 3ã€Œå·®å¼‚å¯¹æ¯”è¡¥å…¨ç¤ºä¾‹ã€ï¼Œæ¼”ç¤ºå®Œæ•´çš„å·®å¼‚è¯†åˆ«å’Œè¡¥å…¨æµç¨‹
  - **æ–°å¢è¯¦ç»†è¯´æ˜**ï¼šAskUserQuestion è°ƒç”¨è§„èŒƒã€é€‰é¡¹çŠ¶æ€æ ‡æ³¨è§„åˆ™ã€ç”¨æˆ·é€‰æ‹©åçš„å¤„ç†

### Technical Details

#### init-ai-md æŠ€èƒ½æ‰§è¡Œæµç¨‹å˜æ›´

**v0.11.0 æµç¨‹**ï¼ˆ4 æ­¥éª¤ï¼‰ï¼š

1. æ£€æŸ¥ CLAUDE.md æ–‡ä»¶
2. è¯»å–æ¨¡æ¿æ–‡ä»¶
3. æ™ºèƒ½åˆå¹¶ç­–ç•¥ï¼ˆç›¸ä¼¼åº¦æ£€æµ‹ + æ›¿æ¢/æ’å…¥ï¼‰
4. åŒæ­¥å…¶ä»– AI è®°å¿†æ–‡ä»¶

**v0.12.0 æµç¨‹**ï¼ˆ5 æ­¥éª¤ï¼‰ï¼š

1. æ£€æŸ¥ CLAUDE.md æ–‡ä»¶
2. **æ‰«æåˆ†æ**ï¼ˆæ–°å¢ï¼‰ï¼šæ‰«æç›®æ ‡æ–‡ä»¶å’Œæ¨¡æ¿ç›®å½•ï¼Œå¯¹æ¯”åˆ†æ
3. **äº¤äº’é€‰æ‹©**ï¼ˆæ–°å¢ï¼‰ï¼šä½¿ç”¨ AskUserQuestion è®©ç”¨æˆ·é€‰æ‹©
4. **å·®å¼‚å¯¹æ¯”ä¸å¢é‡è¡¥å…¨**ï¼ˆæ”¹è¿›ï¼‰ï¼šé€è¡Œå¯¹æ¯”ï¼Œä»…è¡¥å…¨ç¼ºå¤±
5. åŒæ­¥å…¶ä»– AI è®°å¿†æ–‡ä»¶

#### å·®å¼‚å¯¹æ¯”ç¤ºä¾‹

å‡è®¾ç›®æ ‡æ–‡ä»¶ `CLAUDE.md` ä¸­ã€Œè·å–æŠ€æœ¯æ ˆå¯¹åº”çš„ä¸Šä¸‹æ–‡ã€ç« èŠ‚ç¼ºå°‘éƒ¨åˆ†å†…å®¹ï¼š

```markdown
## è·å–æŠ€æœ¯æ ˆå¯¹åº”çš„ä¸Šä¸‹æ–‡

### claude code skill

- ç¼–å†™è¯­æ³•ä¸æ ¼å¼ï¼š https://code.claude.com/docs/zh-CN/skills
- æœ€ä½³å®è·µï¼š https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices
```

æ¨¡æ¿æ–‡ä»¶åŒ…å«å®Œæ•´å†…å®¹ï¼š

```markdown
## è·å–æŠ€æœ¯æ ˆå¯¹åº”çš„ä¸Šä¸‹æ–‡

åœ¨å¤„ç†ç‰¹å®šæŠ€æœ¯æ ˆç›¸å…³çš„é—®é¢˜æ—¶ï¼Œä½ åº”è¯¥ä¸»åŠ¨è·å–å¯¹åº”çš„ä¸Šä¸‹æ–‡æ–‡æ¡£å’Œæœ€ä½³å®è·µã€‚

### claude code skill

- ç¼–å†™è¯­æ³•ä¸æ ¼å¼ï¼š https://code.claude.com/docs/zh-CN/skills
- æœ€ä½³å®è·µï¼š https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices
- è§„èŒƒæ–‡æ¡£ï¼š https://agentskills.io/home
```

**æ­£ç¡®å¤„ç†æ–¹å¼**ï¼šè¯†åˆ«å¹¶è¡¥å…¨ç¼ºå¤±çš„æè¿°æ®µè½å’Œã€Œè§„èŒƒæ–‡æ¡£ã€é“¾æ¥ï¼Œè€Œéå…¨é‡æ›¿æ¢æ•´ä¸ªç« èŠ‚ã€‚

### References

- Claude Code Skills æ–‡æ¡£: https://code.claude.com/docs/zh-CN/skills
- æŠ€èƒ½æœ€ä½³å®è·µ: https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices
- Agent Skills è§„èŒƒ: https://agentskills.io/home

## [0.11.0] - 2026-01-22

### Added

- **æ–°å¢ Skill**: `init-claude-code-statusline` - Claude Code çŠ¶æ€æ é…ç½®åˆå§‹åŒ–æŠ€èƒ½
  - ä½ç½®ï¼š`skills/init-claude-code-statusline/SKILL.md`
  - ç”¨äºåœ¨ä»»ä½•é¡¹ç›®ä¸­å¿«é€Ÿåˆå§‹åŒ–ã€æ›´æ–°æˆ–è¦†ç›– Claude Code çŠ¶æ€æ é…ç½®
  - é…ç½®æ–‡ä»¶ï¼š`.claude/settings.json` å’Œ `.claude/statusline.sh`
  - çŠ¶æ€æ æ˜¾ç¤ºå†…å®¹ï¼šå½“å‰ç›®å½•ã€Git åˆ†æ”¯ï¼ˆğŸŒ¿ï¼‰ã€æ¨¡å‹åç§°ï¼ˆğŸ¤–ï¼‰ã€ç‰ˆæœ¬å·ã€ä¸Šä¸‹æ–‡çª—å£å‰©ä½™ç™¾åˆ†æ¯”ï¼ˆğŸ§ ï¼‰
  - ä¸Šä¸‹æ–‡çª—å£é¢œè‰²ç¼–ç ï¼šç»¿è‰²ï¼ˆ>40%ï¼‰ã€é»„è‰²ï¼ˆ20%-40%ï¼‰ã€çº¢è‰²ï¼ˆ<20%ï¼‰
  - æ”¯æŒ jq å¯ç”¨æ€§æ£€æµ‹å’Œä¼˜é›…é™çº§
  - å½“ç”¨æˆ·æåŠåˆå§‹åŒ–çŠ¶æ€æ ã€é…ç½® Claude Code çŠ¶æ€æ ç­‰å…³é”®è¯æ—¶è‡ªåŠ¨æ¿€æ´»

- **æ–°å¢ Skill**: `init-prettier-git-hooks` - Prettier + Git Hooks æ ¼å¼åŒ–æµç¨‹åˆå§‹åŒ–æŠ€èƒ½
  - ä½ç½®ï¼š`skills/init-prettier-git-hooks/SKILL.md`
  - ç”¨äºåœ¨ä»»ä½• Node.js é¡¹ç›®ä¸­å¿«é€Ÿæ­å»ºä»£ç æ ¼å¼åŒ–å’Œ git é’©å­é…ç½®
  - é›†æˆï¼š`lint-staged` + `simple-git-hooks` + `prettier`
  - æ¨¡æ¿æ–‡ä»¶ï¼š
    - `templates/prettier.config.mjs` - Prettier é…ç½®ï¼ˆå« @prettier/plugin-oxc å’Œ prettier-plugin-lint-mdï¼‰
    - `templates/lint-staged.config.js` - lint-staged é…ç½®
    - `templates/simple-git-hooks.mjs` - git hooks é…ç½®ï¼ˆpre-commit å’Œ commit-msgï¼‰
  - æä¾›å®Œæ•´çš„è‡ªæ£€æ¸…å•å’Œå·¥ä½œæµç¨‹è¯´æ˜

- **æ–°å¢æ¨¡æ¿æ–‡ä»¶**: `skills/init-claude-code-statusline/templates/` ç›®å½•
  - `settings.json` - Claude Code çŠ¶æ€æ è®¾ç½®æ¨¡æ¿
  - `statusline.sh` - çŠ¶æ€æ  Bash è„šæœ¬æ¨¡æ¿ï¼ˆ100 è¡Œï¼ŒåŠŸèƒ½ä¸°å¯Œï¼‰

### Changed

- **Skill é…ç½®æ›´æ–°**: `init-ai-md` æŠ€èƒ½å¯ç”¨ç”¨æˆ·ä¸»åŠ¨è°ƒç”¨
  - æ·»åŠ  `user-invocable: true` é…ç½®é¡¹
  - ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡ `/init-ai-md` å‘½ä»¤ç›´æ¥è°ƒç”¨æ­¤æŠ€èƒ½

- **çŠ¶æ€æ è„šæœ¬ä¼˜åŒ–**: æ›´æ–° `.claude/statusline.sh` é…ç½®
  - æ”¹è¿›é¢œè‰²ä»£ç å®šä¹‰ï¼Œä½¿ç”¨æ›´æ¸…æ™°çš„ ANSI 256 è‰²
  - ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£è®¡ç®—é€»è¾‘

### Technical Details

#### init-claude-code-statusline æŠ€èƒ½æ‰§è¡Œæµç¨‹

1. **æ£€æŸ¥ç›®æ ‡ç›®å½•**ï¼šç¡®ä¿ `.claude/` ç›®å½•å­˜åœ¨
2. **å¤„ç† settings.json**ï¼šæ”¯æŒåˆå¹¶é…ç½®ã€å…¨é‡è¦†ç›–æˆ–è·³è¿‡
3. **å¤„ç† statusline.sh**ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–ç°æœ‰è„šæœ¬
4. **éªŒè¯é…ç½®**ï¼šç¡®è®¤æ–‡ä»¶æ ¼å¼æ­£ç¡®

#### init-prettier-git-hooks æŠ€èƒ½æ‰§è¡Œæµç¨‹

1. **å®‰è£…ä¾èµ–**ï¼š`pnpm add -D prettier @prettier/plugin-oxc prettier-plugin-lint-md lint-staged simple-git-hooks commitlint`
2. **åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼šå¤åˆ¶æ¨¡æ¿åˆ°é¡¹ç›®æ ¹ç›®å½•
3. **æ›´æ–° package.json**ï¼šæ·»åŠ  `format` å’Œ `prepare` scripts
4. **åˆå§‹åŒ– Git Hooks**ï¼šè¿è¡Œ `npx simple-git-hooks`

#### çŠ¶æ€æ è„šæœ¬åŠŸèƒ½

|  æ˜¾ç¤ºé¡¹ç›®  | å›¾æ ‡ |              è¯´æ˜               |
| :--------: | :--: | :-----------------------------: |
|  å½“å‰ç›®å½•  |  æ—   | å·¥ä½œç›®å½•è·¯å¾„ï¼ˆ~æ›¿æ¢ç”¨æˆ·ä¸»ç›®å½•ï¼‰ |
|  Git åˆ†æ”¯  |  ğŸŒ¿  |        å½“å‰ Git åˆ†æ”¯åç§°        |
|  æ¨¡å‹åç§°  |  ğŸ¤–  |     å½“å‰ä½¿ç”¨çš„ Claude æ¨¡å‹      |
|   ç‰ˆæœ¬å·   |  v   |        Claude Code ç‰ˆæœ¬         |
| ä¸Šä¸‹æ–‡çª—å£ |  ğŸ§   |      å‰©ä½™ä¸Šä¸‹æ–‡çª—å£ç™¾åˆ†æ¯”       |

### References

- Claude Code Skills æ–‡æ¡£: https://code.claude.com/docs/zh-CN/skills
- æŠ€èƒ½æœ€ä½³å®è·µ: https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices
- Agent Skills è§„èŒƒ: https://agentskills.io/home

## [0.10.0] - 2026-01-20

### Added

- **æ–°å¢ Skill**: `init-ai-md` - AI è®°å¿†æ–‡ä»¶åˆå§‹åŒ–å’Œå¢é‡æ›´æ–°æŠ€èƒ½
  - ä½ç½®ï¼š`skills/init-ai-md/SKILL.md`
  - ç”¨äºåœ¨é¡¹ç›®ä¸­å¿«é€Ÿåˆå§‹åŒ–å’Œå¢é‡æ›´æ–° AI è®°å¿†æ–‡ä»¶ï¼ˆCLAUDE.mdã€AGENTS.mdã€GEMINI.mdï¼‰
  - å°†é¢„è®¾çš„é€šç”¨æç¤ºè¯æ¨¡æ¿æŒ‰é¡ºåºæ’å…¥åˆ°è®°å¿†æ–‡ä»¶ä¸­
  - æ”¯æŒæ£€æµ‹ç°æœ‰å†…å®¹ç›¸ä¼¼åº¦ï¼Œæ™ºèƒ½åˆå¹¶æˆ–æ›¿æ¢
  - æ”¯æŒåŒæ­¥æ›´æ–° AGENTS.md å’Œ GEMINI.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
  - å½“ç”¨æˆ·æåŠåˆå§‹åŒ–è®°å¿†æ–‡ä»¶ã€æ›´æ–° CLAUDE.mdã€åŒæ­¥ AI è®°å¿†ç­‰å…³é”®è¯æ—¶è‡ªåŠ¨æ¿€æ´»

- **æ–°å¢æ¨¡æ¿æ–‡ä»¶**: `skills/init-ai-md/templates/` ç›®å½•
  - `01.ä¸»åŠ¨é—®è¯¢å®æ–½ç»†èŠ‚.md` - å¼•å¯¼ AI ä¸»åŠ¨è¯¢é—®ç”¨æˆ·å®æ–½ç»†èŠ‚
  - `02.ç¼–å†™æµ‹è¯•ç”¨ä¾‹è§„èŒƒ.md` - Vitest æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ
  - `03.æŠ¥å‘Šç¼–å†™è§„èŒƒ.md` - Markdown æŠ¥å‘Šç¼–å†™è§„èŒƒ
  - `04.ç”Ÿæˆå‘ç‰ˆæ—¥å¿—çš„æ“ä½œè§„èŒƒ.md` - Changeset å‘ç‰ˆæ—¥å¿—è§„èŒƒåŠæœ¯è¯­è¯´æ˜
  - `05.æ²Ÿé€šåä½œè¦æ±‚.md` - è®¡åˆ’æ¨¡å¼ç­‰åä½œè¦æ±‚
  - `99.è·å–æŠ€æœ¯æ ˆå¯¹åº”çš„ä¸Šä¸‹æ–‡.md` - æŠ€æœ¯æ ˆæ–‡æ¡£é“¾æ¥

### Technical Details

#### init-ai-md æŠ€èƒ½æ‰§è¡Œæµç¨‹

1. **æ£€æŸ¥ CLAUDE.md**ï¼šæ£€æµ‹é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æ— åˆ™å…ˆæ‰§è¡Œ `/init` å‘½ä»¤
2. **è¯»å–æ¨¡æ¿**ï¼šæŒ‰æ•°å­—å‰ç¼€é¡ºåºï¼ˆ01â†’99ï¼‰è¯»å– templates ç›®å½•ä¸‹çš„æ¨¡æ¿æ–‡ä»¶
3. **æ™ºèƒ½åˆå¹¶**ï¼šæ£€æµ‹ç›¸ä¼¼å†…å®¹ï¼Œå†³å®šæ›¿æ¢æˆ–åœ¨ç°æœ‰äºŒçº§ç›®å½•ä¹‹å‰æ’å…¥
4. **åŒæ­¥ç¡®è®¤**ï¼šæ£€æµ‹ AGENTS.md/GEMINI.mdï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦åŒæ­¥æ›¿æ¢

#### æ¨¡æ¿æ–‡ä»¶è§„èŒƒ

- æ¨¡æ¿æ–‡ä»¶åªåŒ…å«äºŒçº§ç›®å½•ï¼Œä¸åŒ…å«ä¸€çº§ç›®å½•
- æ–‡ä»¶å‘½åæ ¼å¼ï¼š`XX.æè¿°åç§°.md`ï¼ˆXX ä¸ºä¸¤ä½æ•°å­—ï¼‰
- å†…å®¹ä½¿ç”¨ç®€ä½“ä¸­æ–‡ç¼–å†™
- ä¾¿äºç›´æ¥æ’å…¥åˆ°è®°å¿†æ–‡ä»¶ä¸­

### References

- Claude Code Skills æ–‡æ¡£: https://code.claude.com/docs/zh-CN/skills
- æŠ€èƒ½æœ€ä½³å®è·µ: https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices

## [0.9.2] - 2026-01-05

### Fixed

- **ğŸ Windows + WSL ç¯å¢ƒä¸‹çš„ Hook è·¯å¾„è§£æé”™è¯¯**: ä¿®å¤äº†æ’ä»¶ hooks åœ¨ Windows + WSL/Git Bash ç¯å¢ƒä¸‹æ— æ³•æ­£ç¡®æ‰§è¡Œçš„å…³é”®é—®é¢˜
  - **é—®é¢˜åŸå› **: hooks.json ä¸­çš„å‘½ä»¤ä½¿ç”¨äº† `bash` å‰ç¼€ï¼Œå¯¼è‡´è·¯å¾„è§£æé”™è¯¯
    - å‘½ä»¤æ ¼å¼ï¼š`bash ${CLAUDE_PLUGIN_ROOT}/scripts/task-complete-notifier.sh`
    - `bash` è¢«è§£é‡Šä¸º `/usr/bin/bash`ï¼ˆWSL æˆ– Git Bash çš„ bashï¼‰
    - `${CLAUDE_PLUGIN_ROOT}` å±•å¼€ä¸º Windows è·¯å¾„ï¼ˆ`C:\Users\pc\.claude\plugins\cache\...`ï¼‰
    - WSL bash æ— æ³•æ­£ç¡®å¤„ç† Windows è·¯å¾„ä¸ Unix è·¯å¾„çš„æ··ç”¨
  - **é”™è¯¯è¡¨ç°**:
    - `Plugin hook error: /usr/bin/bash: C:\Users\pc\.claude\plugins\cache\ruan-cat-tools\common-tools\0.9.1/scripts/task-complete-notifier.sh: No such file or directory`
    - Stop hook å’Œ UserPromptSubmit hook å®Œå…¨æ— æ³•æ‰§è¡Œ
    - æ’ä»¶çš„é€šçŸ¥åŠŸèƒ½å¤±æ•ˆ
  - **ä¿®å¤æ–¹æ¡ˆ**: ç§»é™¤ hooks å‘½ä»¤ä¸­çš„ `bash` å‰ç¼€
    - ä¿®å¤å‰ï¼š`"command": "bash ${CLAUDE_PLUGIN_ROOT}/scripts/task-complete-notifier.sh"`
    - ä¿®å¤åï¼š`"command": "${CLAUDE_PLUGIN_ROOT}/scripts/task-complete-notifier.sh"`
    - è„šæœ¬æ–‡ä»¶å·²æœ‰æ­£ç¡®çš„ shebang (`#!/bin/bash`)ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æ­£ç¡®çš„è§£é‡Šå™¨
    - Claude Code ä¼šæ­£ç¡®å¤„ç† `${CLAUDE_PLUGIN_ROOT}` ç¯å¢ƒå˜é‡çš„å±•å¼€å’Œè·¯å¾„è½¬æ¢
  - **å½±å“çš„æ–‡ä»¶**:
    - `hooks/hooks.json:9` - Stop hook çš„ task-complete-notifier.sh è°ƒç”¨
    - `hooks/hooks.json:20` - UserPromptSubmit hook çš„ user-prompt-logger.sh è°ƒç”¨

### Technical Details

#### è·¯å¾„è§£æé—®é¢˜åˆ†æ

åœ¨ Windows + WSL/Git Bash ç¯å¢ƒä¸‹ï¼Œç›´æ¥åœ¨å‘½ä»¤ä¸­ä½¿ç”¨ `bash` å‰ç¼€ä¼šå¯¼è‡´ï¼š

1. **è§£é‡Šå™¨é€‰æ‹©é”™è¯¯**ï¼š`bash` è¢«è§£æä¸º `/usr/bin/bash`ï¼Œè¿™æ˜¯ WSL æˆ– Git Bash çš„ bashï¼Œè€Œä¸æ˜¯ Windows åŸç”Ÿçš„ shell
2. **è·¯å¾„æ ¼å¼å†²çª**ï¼š`${CLAUDE_PLUGIN_ROOT}` å±•å¼€ä¸º Windows è·¯å¾„æ ¼å¼ï¼ˆ`C:\...`ï¼‰ï¼Œä½† WSL bash æœŸæœ› Unix è·¯å¾„æ ¼å¼ï¼ˆ`/mnt/c/...` æˆ– `/c/...`ï¼‰
3. **æ–œæ æ··ç”¨**ï¼šé”™è¯¯ä¿¡æ¯æ˜¾ç¤ºè·¯å¾„æ··ç”¨äº†åæ–œæ å’Œæ­£æ–œæ ï¼š`C:\Users\pc\.claude\plugins\cache\ruan-cat-tools\common-tools\0.9.1/scripts/...`

#### ä¸ºä»€ä¹ˆç§»é™¤ bash å‰ç¼€èƒ½è§£å†³é—®é¢˜ï¼Ÿ

1. **ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©è§£é‡Šå™¨**ï¼šè„šæœ¬æ–‡ä»¶ä»¥ `#!/bin/bash` å¼€å¤´ï¼Œå½“ç›´æ¥æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ® shebang è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„è§£é‡Šå™¨
2. **Claude Code å¤„ç†è·¯å¾„è½¬æ¢**ï¼šç§»é™¤ `bash` å‰ç¼€åï¼ŒClaude Code ä¼šæ­£ç¡®å¤„ç† `${CLAUDE_PLUGIN_ROOT}` çš„å±•å¼€ï¼Œå¹¶æ ¹æ®å½“å‰ç¯å¢ƒè‡ªåŠ¨è½¬æ¢è·¯å¾„æ ¼å¼
3. **è·¨å¹³å°å…¼å®¹æ€§**ï¼šè¿™ç§æ–¹å¼åœ¨ Windowsã€macOS å’Œ Linux ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†

#### Claude Code ç¯å¢ƒå˜é‡è¯´æ˜

æ ¹æ® Claude Code å®˜æ–¹æ–‡æ¡£ï¼Œ`${CLAUDE_PLUGIN_ROOT}` æ˜¯æ ‡å‡†çš„ç¯å¢ƒå˜é‡ï¼š

- **Windows**: `C:\Users\<username>\.claude\plugins\cache\<marketplace>_<plugin-name>\<version>`
- **macOS/Linux**: `~/.claude/plugins/cache/<marketplace>_<plugin-name>/<version>`

è¿™æ˜¯è·å–æ’ä»¶æ ¹ç›®å½•çš„**å”¯ä¸€æ­£ç¡®æ–¹å¼**ï¼Œåœ¨ hooks å’Œ MCP é…ç½®ä¸­éƒ½åº”è¯¥ä½¿ç”¨æ­¤å˜é‡ã€‚

### References

- Claude Code Plugins Reference: https://code.claude.com/docs/en/plugins-reference.md#environment-variables
- Claude Code Hooks Reference: https://code.claude.com/docs/en/hooks.md#plugin-hooks
- ä¿®å¤çš„æ–‡ä»¶ï¼š`hooks/hooks.json`ï¼ˆç¬¬ 9 è¡Œå’Œç¬¬ 20 è¡Œï¼‰

## [0.9.1] - 2025-12-20

### Changed

- **SubagentStop é’©å­ç§»é™¤**: åˆ é™¤äº† SubagentStop é’©å­é…ç½®
  - ç§»é™¤äº† `claude-notifier check-and-notify` åœ¨ SubagentStop äº‹ä»¶ä¸­çš„æ‰§è¡Œ
  - ç®€åŒ–äº†é’©å­é…ç½®ï¼Œé¿å…æ½œåœ¨çš„é‡å¤é€šçŸ¥
  - ç›¸å…³æ–‡ä»¶ï¼š`hooks/hooks.json`ï¼ˆç¬¬ 64-76 è¡Œï¼‰

## [0.9.0] - 2025-12-11

### Added

- **æ–°å¢ Skill**: `openspec` - OpenSpec ä¸­æ–‡ç‰ˆè§„èŒƒåŠ©æ‰‹æŠ€èƒ½
  - ä½ç½®ï¼š`skills/openspec/SKILL.md`
  - å¸®åŠ©ç”¨æˆ·ä½¿ç”¨ OpenSpec ä¸­æ–‡ç‰ˆï¼ˆ`@org-hex/openspec-chinese`ï¼‰å·¥å…·
  - æä¾›é¡¹ç›®åˆå§‹åŒ–ã€åˆ›å»ºææ¡ˆã€ç¼–å†™è§„æ ¼æ–‡æ¡£çš„å®Œæ•´æŒ‡å¯¼
  - åŒ…å«è§„æ ¼æ–‡æ¡£æ ¼å¼è¦æ±‚ï¼ˆDelta åˆ†åŒºã€Requirement è¯­å¥ã€Scenario åœºæ™¯ï¼‰
  - æä¾›å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥å’Œé—®é¢˜æ’æŸ¥æŒ‡å—
  - æ”¯æŒè§„æ ¼å…¨ç”Ÿå‘½å‘¨æœŸæµç¨‹ç®¡ç†
  - å½“ç”¨æˆ·æåŠ `openspec`ã€è§„èŒƒæ–‡æ¡£ã€éœ€æ±‚ç®¡ç†ç­‰å…³é”®è¯æ—¶è‡ªåŠ¨æ¿€æ´»

### Changed

- **æ’ä»¶ç»“æ„ä¼˜åŒ–**: æ–°å¢ `skills/` ç›®å½•ç”¨äºå­˜æ”¾æŠ€èƒ½æ–‡ä»¶
- **æ–‡æ¡£ä¼˜åŒ–**: åœ¨ README.md ä¸­æ–°å¢ Skills éƒ¨åˆ†ï¼Œè¯´æ˜ OpenSpec è§„èŒƒåŠ©æ‰‹æŠ€èƒ½

## [0.8.4] - 2025-11-28

### Added

- **æ–°å¢ Agent**: `add-git-mcp` - ç”¨äºåœ¨ `.mcp.json` æ–‡ä»¶å†…é…ç½®æ»¡è¶³ git-mcp æ ¼å¼çš„ MCP æœåŠ¡å™¨
  - æ”¯æŒé€šè¿‡ GitHub ä»“åº“åœ°å€è‡ªåŠ¨ç”Ÿæˆ git-mcp é…ç½®
  - å®ç°å¯¹ GitHub ä»“åº“æºç å’Œæ–‡ä»¶çš„ç²¾å‡†ç´¢å¼•ï¼Œé¿å…ä»£ç å¹»è§‰
  - æä¾›æ ‡å‡†åŒ–çš„ MCP æœåŠ¡å™¨å‘½åæ ¼å¼ï¼š`gitmcp__{repo}__{owner}`
  - æ”¯æŒå‘½ä»¤è¡Œå’Œæ‰‹åŠ¨é…ç½®ä¸¤ç§æ·»åŠ æ–¹å¼

### Changed

- **æ’ä»¶é…ç½®æ›´æ–°**: åœ¨ `plugin.json` ä¸­æ–°å¢ `add-git-mcp.md` agent å¼•ç”¨
- **æ–‡æ¡£ä¼˜åŒ–**: æ›´æ–° README.md ä¸­çš„ agents åˆ—è¡¨ï¼ŒåŒ…å«æ–°å¢çš„ git-mcp é…ç½®ä»£ç†

## [0.8.3] - 2025-11-20

### Changed

- **é¡¹ç›®æ ¹ç›®å½•æ£€æµ‹é€»è¾‘ä¼˜åŒ–**: ä¼˜åŒ–äº† `task-complete-notifier.sh` è„šæœ¬ä¸­çš„é¡¹ç›®æ ¹ç›®å½•æ£€æµ‹é€»è¾‘
  - å°†é¡¹ç›®æ ¹ç›®å½•æ£€æµ‹é€»è¾‘ç§»åŠ¨åˆ°è„šæœ¬å‰é¢ï¼Œåœ¨ç«‹å³é€šçŸ¥é˜¶æ®µå°±å®Œæˆæ£€æµ‹
  - é¿å…äº†åœ¨è„šæœ¬æœ«å°¾é‡å¤æ‰§è¡Œç›¸åŒçš„æ£€æµ‹é€»è¾‘
  - æ·»åŠ äº† `Detected project directory: $PROJECT_DIR` æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•
  - æå‡äº†è„šæœ¬æ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘äº†é‡å¤ä»£ç 

## [0.8.2] - 2025-11-20

### Changed

- **é€šçŸ¥è¶…æ—¶æ—¶é—´ä¼˜åŒ–**: è°ƒæ•´é€šçŸ¥å¼¹æ¡†çš„è¶…æ—¶æ—¶é—´ä»¥ç¡®ä¿å®Œæ•´æ˜¾ç¤º
  - ç«‹å³é€šçŸ¥è¶…æ—¶ï¼š1s â†’ 8sï¼ˆ`task-complete-notifier.sh:90`ï¼‰
  - Gemini æ€»ç»“åé€šçŸ¥è¶…æ—¶ï¼š2s â†’ 8sï¼ˆ`task-complete-notifier.sh:301`ï¼‰
  - Stop é’©å­æ€»è¶…æ—¶ï¼š20s â†’ 45sï¼ˆ`hooks.json:10`ï¼‰
  - è„šæœ¬å…¨å±€è¶…æ—¶ï¼š18s â†’ 43sï¼ˆ`task-complete-notifier.sh:11`ï¼‰
  - **åŸå› **: é€šçŸ¥å¼¹æ¡†ä»æ‰“å¼€åˆ°å®Œå…¨å…³é—­è‡³å°‘éœ€è¦ 8 ç§’
  - **æ•ˆæœ**: ç¡®ä¿é€šçŸ¥æœ‰è¶³å¤Ÿæ—¶é—´å®Œæ•´æ˜¾ç¤ºï¼Œä¸ä¼šè¢«è¿‡æ—©ä¸­æ–­

## [0.8.1] - 2025-11-20

### Fixed

- **ğŸ ä¿®å¤ Stop hooks çš„ stdin è¶…æ—¶ä¸­æ­¢é—®é¢˜**: å½»åº•è§£å†³äº† `â— Stop hook failed: The operation was aborted` çš„æŒç»­æ€§æ•…éšœ
  - **æ ¸å¿ƒé—®é¢˜**: Stop hooks ä¸­ç¬¬äºŒä¸ªé’©å­ `claude-notifier task-complete` ä¸ç¬¬ä¸€ä¸ªé’©å­å­˜åœ¨ stdin ç«äº‰
    - ç¬¬ä¸€ä¸ªé’©å­ï¼ˆ`task-complete-notifier.sh`ï¼‰å·²ç»æ¶ˆè´¹äº†æ‰€æœ‰ stdin æ•°æ®
    - ç¬¬äºŒä¸ªé’©å­è™½ç„¶ä¸éœ€è¦ stdinï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ç­‰å¾…è¶…æ—¶
    - ä¸¤ä¸ªé’©å­ä¸²è¡Œæ‰§è¡Œï¼Œæ€»è€—æ—¶æ¥è¿‘æˆ–è¶…è¿‡ Claude Code çš„å®¹å¿èŒƒå›´
  - **è§£å†³æ–¹æ¡ˆ**:
    1. å°†ç¬¬äºŒä¸ªé’©å­çš„é€šçŸ¥åŠŸèƒ½æ•´åˆåˆ° `task-complete-notifier.sh` å¼€å¤´
    2. æ·»åŠ ç«‹å³é€šçŸ¥ï¼ˆ1 ç§’è¶…æ—¶ï¼‰ï¼Œåœ¨ Gemini æ€»ç»“å‰å‘é€
    3. åˆ é™¤ hooks.json ä¸­å¤šä½™çš„ç¬¬äºŒä¸ªé’©å­
  - **ä¿®å¤æ•ˆæœ**:
    - âœ… æ¶ˆé™¤ stdin ç«äº‰ï¼Œä¸å†æœ‰å¤šä¸ªé’©å­äº‰æŠ¢è¾“å…¥æµ
    - âœ… é¿å…é‡å¤é€šçŸ¥ï¼ˆåŸç¬¬äºŒä¸ªé’©å­ä¼šå¯¼è‡´åŒé‡é€šçŸ¥ï¼‰
    - âœ… ç¼©çŸ­æ€»æ‰§è¡Œæ—¶é—´ï¼Œä¸å†è¶…æ—¶ä¸­æ­¢
    - âœ… ä¿ç•™åŒé‡é€šçŸ¥ä½“éªŒï¼ˆç«‹å³é€šçŸ¥ + Gemini æ™ºèƒ½æ€»ç»“ï¼‰
  - **ç›¸å…³æ–‡ä»¶**:
    - ä¿®æ”¹ï¼š`scripts/task-complete-notifier.sh`ï¼ˆæ–°å¢ç«‹å³é€šçŸ¥é€»è¾‘ï¼‰
    - ä¿®æ”¹ï¼š`hooks/hooks.json`ï¼ˆåˆ é™¤ç¬¬äºŒä¸ª Stop é’©å­ï¼‰

### Changed

- **Stop hooks é€šçŸ¥æœºåˆ¶ä¼˜åŒ–**: é‡æ–°è®¾è®¡é€šçŸ¥æµç¨‹ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
  - ç«‹å³é€šçŸ¥ï¼ˆ~1 ç§’å†…ï¼‰: "é gemini æ€»ç»“ï¼šä»»åŠ¡å®Œæˆ"ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
  - Gemini æ€»ç»“ï¼ˆ~5-15 ç§’åï¼‰: æ™ºèƒ½ç”Ÿæˆçš„ä»»åŠ¡æ‘˜è¦ï¼ˆè¯¦ç»†æè¿°ï¼‰
  - å•ä¸€é’©å­å†…å®Œæˆæ‰€æœ‰é€šçŸ¥é€»è¾‘ï¼Œé¿å…è¿›ç¨‹é—´ç«äº‰

### Technical Details

#### é—®é¢˜æœºåˆ¶åˆ†æ

**ä¿®å¤å‰çš„é…ç½®**ï¼ˆå­˜åœ¨ stdin ç«äº‰ï¼‰ï¼š

```json
"Stop": [
  {
    "hooks": [
      {"command": "bash .../task-complete-notifier.sh", "timeout": 20},  // æ¶ˆè´¹ stdin
      {"command": "claude-notifier task-complete ...", "timeout": 5}     // stdin å·²ç©ºï¼Œå¯èƒ½è¶…æ—¶
    ]
  }
]
```

**ä¿®å¤åçš„é…ç½®**ï¼ˆå•ä¸€é’©å­ï¼Œæ— ç«äº‰ï¼‰ï¼š

```json
"Stop": [
  {
    "hooks": [
      {"command": "bash .../task-complete-notifier.sh", "timeout": 20}  // å†…éƒ¨å®Œæˆæ‰€æœ‰é€šçŸ¥
    ]
  }
]
```

#### æ–°å¢çš„ç«‹å³é€šçŸ¥é€»è¾‘

åœ¨ `task-complete-notifier.sh` ç¬¬ 81-104 è¡Œæ–°å¢ï¼š

```bash
# ====== ç«‹å³å‘é€åˆå§‹é€šçŸ¥ï¼ˆæ— éœ€ç­‰å¾… Geminiï¼‰ ======
log "====== Sending Immediate Notification ======"
log "å‘é€ç«‹å³é€šçŸ¥: égeminiæ€»ç»“ï¼šä»»åŠ¡å®Œæˆ"

IMMEDIATE_START=$(date +%s)

# åŒæ­¥è°ƒç”¨ï¼Œ1 ç§’è¶…æ—¶
(
  cd "$PROJECT_DIR" 2>/dev/null || cd /
  timeout 1s claude-notifier task-complete --message "égeminiæ€»ç»“ï¼šä»»åŠ¡å®Œæˆ" 2>&1 || {
    EXIT_CODE=$?
    if [ $EXIT_CODE -eq 124 ]; then
      echo "âš ï¸ Immediate notifier timed out (1s)"
    else
      echo "âš ï¸ Immediate notifier failed with exit code $EXIT_CODE"
    fi
  }
) >> "$LOG_FILE"

IMMEDIATE_END=$(date +%s)
IMMEDIATE_DURATION=$((IMMEDIATE_END - IMMEDIATE_START))

log "ç«‹å³é€šçŸ¥å·²å‘é€ï¼Œè€—æ—¶: ${IMMEDIATE_DURATION}s"
```

#### æ‰§è¡Œæµç¨‹å¯¹æ¯”

**ä¿®å¤å‰**ï¼ˆåŒé’©å­ï¼Œå­˜åœ¨ç«äº‰ï¼‰ï¼š

```plain
Stop Event
    â†“
Hook 1: task-complete-notifier.sh (è¯»å– stdin)
    â”œâ”€ è¯»å– stdin âœ…
    â”œâ”€ Gemini æ€»ç»“ (~5-15s)
    â””â”€ å‘é€é€šçŸ¥
    â†“
Hook 2: claude-notifier task-complete
    â”œâ”€ å°è¯•è¯»å– stdin âŒï¼ˆå·²ç©ºï¼‰
    â”œâ”€ å¯èƒ½ç­‰å¾…è¶…æ—¶
    â””â”€ å‘é€é€šçŸ¥ï¼ˆé‡å¤ï¼ï¼‰
    â†“
æ€»è€—æ—¶: 20+ ç§’ï¼Œå¯èƒ½è¶…æ—¶ä¸­æ­¢
```

**ä¿®å¤å**ï¼ˆå•é’©å­ï¼Œæ— ç«äº‰ï¼‰ï¼š

```plain
Stop Event
    â†“
Hook 1: task-complete-notifier.sh
    â”œâ”€ è¯»å– stdin âœ…
    â”œâ”€ ç«‹å³é€šçŸ¥ (~1s) âœ…
    â”œâ”€ Gemini æ€»ç»“ (~5-15s)
    â””â”€ Gemini é€šçŸ¥ âœ…
    â†“
æ€»è€—æ—¶: ~6-16 ç§’ï¼Œç¨³å®šå®Œæˆ
```

### References

- é—®é¢˜åˆ†æï¼šæœ¬æ¬¡å¯¹è¯ä¸­çš„è¯¦ç»†æ’æŸ¥
- ä¿®å¤è„šæœ¬ï¼š
  - `scripts/task-complete-notifier.sh`ï¼ˆç¬¬ 81-104 è¡Œï¼šæ–°å¢ç«‹å³é€šçŸ¥ï¼‰
  - `hooks/hooks.json`ï¼ˆç¬¬ 4-14 è¡Œï¼šåˆ é™¤ç¬¬äºŒä¸ªé’©å­ï¼‰

## [0.8.0] - 2025-11-19

### Fixed

- **ğŸ”§ ä¿®å¤ Stop hooks çš„ stdin ç«äº‰é—®é¢˜**: è§£å†³äº†ä»»åŠ¡åˆ é™¤å¤±è´¥å’Œé‡å¤é€šçŸ¥çš„æ ¹æœ¬åŸå› 
  - **æ ¸å¿ƒé—®é¢˜**: å¤šä¸ªé’©å­ç«äº‰è¯»å–å•ä¸€ stdin æµï¼Œå¯¼è‡´ `check-and-notify` æ— æ³•è·å–äº‹ä»¶æ•°æ®
  - **è§£å†³æ–¹æ¡ˆ**:
    1. åˆ›å»º `remove-task.ts` è„šæœ¬ç”¨äºç›´æ¥åˆ é™¤ä»»åŠ¡ï¼ˆä¸ä¾èµ– stdinï¼‰
    2. åœ¨ `task-complete-notifier.sh` ä¸­æ·»åŠ ä»»åŠ¡åˆ é™¤é€»è¾‘
    3. ä» Stop hooks ä¸­ç§»é™¤ `check-and-notify`ï¼ˆé¿å… stdin ç«äº‰ï¼‰
  - **ä¿®å¤æ–‡ä»¶**:
    - æ–°å¢ï¼š`packages/claude-notifier/src/scripts/remove-task.ts`
    - ä¿®æ”¹ï¼š`scripts/task-complete-notifier.sh`ï¼ˆæ·»åŠ åˆ é™¤ä»»åŠ¡é€»è¾‘ï¼‰
    - ä¿®æ”¹ï¼š`hooks/hooks.json`ï¼ˆç§»é™¤ Stop ä¸­çš„ check-and-notifyï¼‰
  - **æ•ˆæœ**:
    - âœ… ä»»åŠ¡å®Œæˆåæ­£ç¡®åˆ é™¤ï¼Œä¸å†äº§ç”Ÿè¯¯æŠ¥é€šçŸ¥
    - âœ… Stop hooks ä¸å†è¶…æ—¶æˆ–å¤±è´¥
    - âœ… é¿å… 6 åˆ†é’Ÿã€10 åˆ†é’Ÿçš„é”™è¯¯é•¿ä»»åŠ¡æé†’

### Changed

- **Stop hooks æ¶æ„ä¼˜åŒ–**: é‡æ–°è®¾è®¡ Stop hooks çš„é’©å­ç»„æˆ
  - ç§»é™¤ï¼š`claude-notifier check-and-notify`ï¼ˆé¿å… stdin ç«äº‰ï¼‰
  - ä¿ç•™ï¼š`task-complete-notifier.sh`ï¼ˆè¯»å– stdinï¼Œç”Ÿæˆæ€»ç»“ï¼Œåˆ é™¤ä»»åŠ¡ï¼‰
  - ä¿ç•™ï¼š`claude-notifier task-complete`ï¼ˆå‘é€ç‹¬ç«‹é€šçŸ¥ï¼‰
  - ç¯å¢ƒå˜é‡æ”¯æŒï¼š`check-and-notify` æ–°å¢ç¯å¢ƒå˜é‡é™çº§ç­–ç•¥ï¼ˆ`CLAUDE_CWD`, `CLAUDE_HOOK_EVENT`ï¼‰

### Breaking Changes

âš ï¸ **é‡è¦å˜æ›´**: Stop hooks é…ç½®æ–¹å¼å˜æ›´

**æ—§é…ç½®**ï¼ˆv0.7.3 åŠä¹‹å‰ï¼‰ï¼š

```json
"Stop": [
  {
    "hooks": [
      {"command": "bash .../task-complete-notifier.sh", "timeout": 20},
      {"command": "claude-notifier task-complete ...", "timeout": 5},
      {"command": "claude-notifier check-and-notify", "timeout": 5}  // âŒ å·²ç§»é™¤
    ]
  }
]
```

**æ–°é…ç½®**ï¼ˆv0.8.0ï¼‰ï¼š

```json
"Stop": [
  {
    "hooks": [
      {"command": "bash .../task-complete-notifier.sh", "timeout": 20},
      {"command": "claude-notifier task-complete ...", "timeout": 5}
    ]
  }
]
```

**è¿ç§»æŒ‡å—**:

- å¦‚æœä½ è‡ªå®šä¹‰äº† Stop hooks é…ç½®ï¼Œè¯·**ç§»é™¤** `claude-notifier check-and-notify`
- `task-complete-notifier.sh` ç°åœ¨ä¼šè‡ªåŠ¨åˆ é™¤ä»»åŠ¡ï¼Œæ— éœ€é¢å¤–é…ç½®
- å…¶ä»– hooksï¼ˆUserPromptSubmit, PreToolUse ç­‰ï¼‰ä»ä¿ç•™ `check-and-notify`

### Technical Details

#### stdin ç«äº‰é—®é¢˜åˆ†æ

**é—®é¢˜æœºåˆ¶**ï¼š

1. Claude Code å‘æ¯ä¸ªé’©å­ä¼ é€’ç›¸åŒçš„ stdin æ•°æ®
2. Node.js stdin æµåªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼ˆæµå¼è¯»å–ç‰¹æ€§ï¼‰
3. ç¬¬ä¸€ä¸ªé’©å­ï¼ˆ`task-complete-notifier.sh`ï¼‰è¯»å– stdin æˆåŠŸ
4. ç¬¬ä¸‰ä¸ªé’©å­ï¼ˆ`check-and-notify`ï¼‰å°è¯•è¯»å– stdinï¼Œä½†æµå·²è¢«æ¶ˆè´¹
5. `readHookInput()` 500ms è¶…æ—¶åè¿”å› `null`
6. `check-and-notify` æå‰è¿”å›ï¼Œåˆ é™¤ä»»åŠ¡çš„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ

**æ–°æ¶æ„**ï¼š

```plain
Stop Event
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hook 1: task-complete-notifier.sh                  â”‚
â”‚   âœ… è¯»å– stdinï¼ˆSession ID, Transcript Pathï¼‰       â”‚
â”‚   âœ… æå–å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆtranscript-reader.tsï¼‰          â”‚
â”‚   âœ… ç”Ÿæˆ Gemini æ€»ç»“                                â”‚
â”‚   âœ… åˆ é™¤ä»»åŠ¡ï¼ˆtsx remove-task.tsï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hook 2: claude-notifier task-complete              â”‚
â”‚   âœ… å‘é€ç‹¬ç«‹é€šçŸ¥ï¼ˆä¸ä¾èµ– stdinï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯¹æ¯”æ—§æ¶æ„**ï¼š

- âŒ ç¬¬ä¸‰ä¸ªé’©å­æ— æ³•è¯»å– stdin â†’ ä»»åŠ¡æ— æ³•åˆ é™¤ â†’ è¯¯æŠ¥é€šçŸ¥
- âœ… ç°åœ¨åªæœ‰ä¸€ä¸ªé’©å­è¯»å– stdin â†’ é¿å…ç«äº‰ â†’ ä»»åŠ¡æ­£ç¡®åˆ é™¤

### References

- è¯¦ç»†åˆ†æï¼š`docs/reports/2025-11-19-stop-hooks-failure-analysis.md`
- ä¿®å¤è„šæœ¬ï¼š
  - `packages/claude-notifier/src/scripts/remove-task.ts`ï¼ˆæ–°å¢ï¼‰
  - `scripts/task-complete-notifier.sh`ï¼ˆä¿®æ”¹ï¼‰
  - `hooks/hooks.json`ï¼ˆä¿®æ”¹ï¼‰

## [0.7.3] - 2025-11-19

### Fixed

- **ğŸ ä¿®å¤ Stop hooks è¶…æ—¶å¯¼è‡´çš„ä¸­æ­¢é”™è¯¯**: è§£å†³äº† `â— Stop hook failed: The operation was aborted` çš„æ ¸å¿ƒé—®é¢˜
  - **é—®é¢˜åŸå› **:
    - `task-complete-notifier.sh` ä¸­çš„ `claude-notifier` ä»¥åå°è¿›ç¨‹è¿è¡Œï¼ˆ`&`ï¼‰
    - åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œåå°å­è¿›ç¨‹æœªè¢«å®Œå…¨æ¸…ç†
    - è„šæœ¬é€€å‡ºæ—¶é—ç•™çš„è¿›ç¨‹å¯¼è‡´ Claude Code é’©å­ç³»ç»Ÿè¶…æ—¶
  - **ä¿®å¤æ–¹æ¡ˆ**:
    1. **æ”¹ä¸ºåŒæ­¥è°ƒç”¨**: ç§»é™¤åå°è¿è¡Œ `&`ï¼Œç›´æ¥æ‰§è¡Œå¹¶ç­‰å¾…å®Œæˆ
    2. **æ–°å¢è¿›ç¨‹æ¸…ç†å‡½æ•°**: `cleanup_processes()` å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰å­è¿›ç¨‹
       - ä½¿ç”¨ `pgrep -P $$` æŸ¥æ‰¾å­è¿›ç¨‹ï¼Œ`kill -9` å¼ºåˆ¶ç»ˆæ­¢
       - Windows ç‰¹å®šï¼šä½¿ç”¨ `pkill -9 -f "claude-notifier"` æ¸…ç†æ®‹ç•™
    3. **ä¸‰é‡æ¸…ç†ä¿éšœ**:
       - æ‰§è¡Œåç«‹å³æ¸…ç†ï¼ˆnotifier è¿è¡Œå®Œæ¯•ï¼‰
       - è„šæœ¬é€€å‡ºå‰å†æ¬¡æ¸…ç†ï¼ˆç¡®ä¿æ— æ®‹ç•™ï¼‰
       - é”™è¯¯æ•è·æ—¶æ¸…ç†ï¼ˆtrap ERR EXITï¼‰
    4. **ä¼˜åŒ–è¶…æ—¶æ—¶é—´**: notifier timeout ä» 3s é™åˆ° 2sï¼ˆæ›´æ¿€è¿›ï¼‰
  - **æ•ˆæœ**: Stop hooks ä¸å†è¶…æ—¶ï¼Œæ‰€æœ‰ 3 ä¸ªé’©å­éƒ½èƒ½æ­£å¸¸å®Œæˆ
  - **ç›¸å…³æ–‡ä»¶**: `scripts/task-complete-notifier.sh:50-65, 260-297, 304-307`

### Changed

- **è¿›ç¨‹ç®¡ç†ç­–ç•¥ä¼˜åŒ–** (`task-complete-notifier.sh`):
  - åå°è¿›ç¨‹ `(timeout 3s claude-notifier ...) &` â†’ åŒæ­¥è°ƒç”¨ `(timeout 2s claude-notifier ...)`
  - ç§»é™¤å¤æ‚çš„è¿›ç¨‹ç­‰å¾…é€»è¾‘ï¼ˆä¸å†éœ€è¦ waitã€kill -0 æ£€æŸ¥ï¼‰
  - ç®€åŒ–è„šæœ¬ç»“æ„ï¼Œæå‡å¯é æ€§

### Technical Details

#### ä¿®å¤å‰çš„é—®é¢˜

**åå°è¿›ç¨‹ç®¡ç†**ï¼ˆç¬¬ 253-307 è¡Œï¼‰ï¼š

```bash
# åå°è¿è¡Œ
(timeout 3s claude-notifier ...) &
NOTIFIER_PID=$!

# å°è¯•ç­‰å¾… 4 ç§’ï¼Œæ£€æŸ¥è¿›ç¨‹çŠ¶æ€
for i in $(seq 1 20); do
  if ! kill -0 $NOTIFIER_PID 2>/dev/null; then
    break
  fi
  sleep 0.2
done

# éé˜»å¡ç­‰å¾…ï¼ˆå¯èƒ½é—ç•™å­è¿›ç¨‹ï¼‰
wait $NOTIFIER_PID 2>/dev/null || true
```

**é—®é¢˜**ï¼š

- Windows Git Bash ç¯å¢ƒä¸‹ï¼Œ`wait` å¯èƒ½æ— æ³•æ­£ç¡®ç­‰å¾…å­è¿›ç¨‹
- `timeout` å‘½ä»¤çš„å­è¿›ç¨‹æ¸…ç†ä¸å½»åº•
- è„šæœ¬é€€å‡ºæ—¶ï¼Œåå°è¿›ç¨‹å¯èƒ½ä»åœ¨è¿è¡Œ

#### ä¿®å¤åçš„å®ç°

**åŒæ­¥è°ƒç”¨ + å¼ºåˆ¶æ¸…ç†**ï¼š

```bash
# 1. æ–°å¢æ¸…ç†å‡½æ•°
cleanup_processes() {
  # æ¸…ç†æ‰€æœ‰å­è¿›ç¨‹
  if command -v pgrep &> /dev/null; then
    CHILD_PIDS=$(pgrep -P $$ 2>/dev/null || true)
    if [ -n "$CHILD_PIDS" ]; then
      kill -9 $CHILD_PIDS 2>/dev/null || true
    fi
  fi

  # Windows ç‰¹å®šæ¸…ç†
  if [ "$(uname -o 2>/dev/null || echo '')" = "Msys" ] || [ -n "${WINDIR:-}" ]; then
    pkill -9 -f "claude-notifier" 2>/dev/null || true
  fi
}

# 2. é”™è¯¯æ•è·
trap 'cleanup_processes; log "Script interrupted..."; exit 0' ERR EXIT

# 3. åŒæ­¥è°ƒç”¨ï¼ˆä¸ç”¨ &ï¼‰
(timeout 2s claude-notifier ...) >> "$LOG_FILE"

# 4. ç«‹å³æ¸…ç†
cleanup_processes

# 5. é€€å‡ºå‰å†æ¬¡æ¸…ç†
cleanup_processes
echo "$OUTPUT_JSON"
exit 0
```

#### æ¸…ç†ä¿éšœæœºåˆ¶

| æ¸…ç†æ—¶æœº     | è§¦å‘æ¡ä»¶          | ä»£ç ä½ç½®                  |
| ------------ | ----------------- | ------------------------- |
| æ‰§è¡Œåæ¸…ç†   | notifier è¿è¡Œå®Œæ¯• | ç¬¬ 295 è¡Œ                 |
| é€€å‡ºå‰æ¸…ç†   | è„šæœ¬æ­£å¸¸é€€å‡º      | ç¬¬ 306 è¡Œ                 |
| é”™è¯¯æ•è·æ¸…ç† | è„šæœ¬å¼‚å¸¸/ä¸­æ–­     | trap ERR EXITï¼ˆç¬¬ 67 è¡Œï¼‰ |

#### Windows ç¯å¢ƒç‰¹æ®Šå¤„ç†

Windows Git Bash (MSYS) ç¯å¢ƒä¸‹çš„è¿›ç¨‹ç®¡ç†é—®é¢˜ï¼š

- å­è¿›ç¨‹å¯èƒ½ä¸ä¼šè¢«çˆ¶è¿›ç¨‹çš„ `wait` æ­£ç¡®å›æ”¶
- `timeout` å‘½ä»¤çš„å®ç°ä¸ Linux ä¸åŒ
- éœ€è¦é¢å¤–ä½¿ç”¨ `pkill -f` æŒ‰åç§°å¼ºåˆ¶æ¸…ç†

**æ£€æµ‹é€»è¾‘**ï¼š

```bash
if [ "$(uname -o 2>/dev/null || echo '')" = "Msys" ] || [ -n "${WINDIR:-}" ]; then
  pkill -9 -f "claude-notifier" 2>/dev/null || true
fi
```

### Testing

éªŒè¯ä¿®å¤æ•ˆæœçš„æ–¹æ³•ï¼š

1. **è§‚å¯Ÿé’©å­æ‰§è¡Œ**ï¼šä¸åº”å†å‡ºç° `running stop hooksâ€¦ 3/4` å¡ä½
2. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹ `/tmp/claude-code-task-complete-notifier-logs/` æœ€æ–°æ—¥å¿—
   - åº”è¯¥çœ‹åˆ° `Cleanup verified` å’Œ `All child processes terminated`
   - notifier åº”è¯¥åœ¨ 2 ç§’å†…å®Œæˆ
3. **æ£€æŸ¥è¿›ç¨‹æ®‹ç•™**ï¼š
   ```bash
   ps aux | grep claude-notifier  # åº”è¯¥æ— æ®‹ç•™è¿›ç¨‹
   ```

### References

- é—®é¢˜æ’æŸ¥ï¼šæœ¬æ¬¡å¯¹è¯ä¸­çš„è¯¦ç»†åˆ†æ
- ä¿®å¤è„šæœ¬ï¼š`scripts/task-complete-notifier.sh`
- ç›¸å…³æ—¥å¿—ï¼š`/tmp/claude-code-task-complete-notifier-logs/2025-11-19__21-42-27__*.log`ï¼ˆæ—§ç‰ˆæœ¬ï¼‰

## [0.7.2] - 2025-11-19

### Fixed

- **ğŸ ä¿®å¤ `check-and-notify` åœ¨ Stop äº‹ä»¶çš„é€»è¾‘é”™è¯¯**
  - **é—®é¢˜**: å½“ hookInput ä¸º null æ—¶ï¼Œä»ç„¶æ‰§è¡Œåç»­é€»è¾‘ï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤„ç†
  - **ä¿®å¤**: æ·»åŠ æå‰è¿”å›é€»è¾‘ï¼Œå½“ hookInput ä¸º null æ—¶ç«‹å³è¿”å›ï¼Œé¿å…æ‰§è¡Œæ— æ•ˆæ“ä½œ
  - **æ•ˆæœ**: æå‡ Stop hooks çš„æ‰§è¡Œæ€§èƒ½å’Œç¨³å®šæ€§
  - **ç›¸å…³åŒ…**: `@ruan-cat/claude-notifier@0.8.2`

### Changed

- **Stop hooks é…ç½®ä¼˜åŒ–** (`hooks.json`):
  - è°ƒæ•´é’©å­æ‰§è¡Œé¡ºåºï¼š`check-and-notify` ç°åœ¨åœ¨ `task-complete-notifier.sh` ä¹‹å‰æ‰§è¡Œ
  - ç§»é™¤ `cleanup-orphan-processes.sh`ï¼ˆå·²ä¸å†éœ€è¦ï¼‰

### Removed

- **ç§»é™¤è¿›ç¨‹æ¸…ç†è„šæœ¬**: åˆ é™¤ `cleanup-orphan-processes.sh`
  - `@ruan-cat/claude-notifier` çš„æ”¹è¿›å·²è§£å†³è¿›ç¨‹æ¸…ç†é—®é¢˜
  - ç®€åŒ– Stop hooks é…ç½®ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤æ‚æ€§

## [0.7.1] - 2025-11-19

### Fixed

- **ğŸ ä¿®å¤ Stop hooks è¶…æ—¶å’Œé€»è¾‘é”™è¯¯**
  - **é—®é¢˜ 1**: `check-and-notify` åœ¨ Stop äº‹ä»¶æ—¶æ‰§è¡Œäº†é”™è¯¯çš„é€»è¾‘
    - **åŸå› **: ä»£ç è¦æ±‚ `stop_hook_active === true`ï¼Œä½† Claude Code ä¼ é€’çš„å€¼æ€»æ˜¯ `false`
    - **å½±å“**: Stop äº‹ä»¶æ—¶æ²¡æœ‰åˆ é™¤ä»»åŠ¡ï¼Œåè€Œæ‰§è¡Œäº†"æ¸…ç†å’Œé€šçŸ¥"é€»è¾‘
    - **ä¿®å¤**: ç§»é™¤å¯¹ `stop_hook_active === true` çš„åˆ¤æ–­ï¼Œåªè¦æ˜¯ Stop/SubagentStop äº‹ä»¶å°±åˆ é™¤ä»»åŠ¡
    - **ç›¸å…³åŒ…**: `@ruan-cat/claude-notifier@0.8.1`

  - **é—®é¢˜ 2**: `cleanup-orphan-processes.sh` æ‰§è¡Œè¶…æ—¶ï¼ˆ14 ç§’ > 10 ç§’ timeoutï¼‰
    - **åŸå› **: PowerShell æŸ¥æ‰¾åˆ° 52 ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ npx è¿›ç¨‹ï¼Œé€ä¸ªå°è¯•æ€æ­»ï¼Œæ¯æ¬¡å¤±è´¥éƒ½è€—è´¹æ—¶é—´
    - **ä¼˜åŒ–**:
      1. é™åˆ¶æœ€å¤šå¤„ç† 10 ä¸ªè¿›ç¨‹ï¼ˆ`Select-Object -First 10`ï¼‰
      2. ä½¿ç”¨åå°å¹¶è¡Œæ‰§è¡Œ `taskkill`ï¼Œä¸ç­‰å¾…æ¯ä¸ªå‘½ä»¤è¾“å‡º
      3. åªç­‰å¾… 1 ç§’è®© taskkill å®Œæˆ
    - **æ•ˆæœ**: æ‰§è¡Œæ—¶é—´ä» 14 ç§’é™ä½åˆ° 3-5 ç§’
    - **é…ç½®**: timeout ä» 10 ç§’å¢åŠ åˆ° 15 ç§’ï¼ˆä¿é™©èµ·è§ï¼‰

### Changed

- **Stop hooks é…ç½®è°ƒæ•´** (`hooks.json`):
  - `cleanup-orphan-processes.sh` çš„ timeout: `10` â†’ `15` ç§’

- **æ€§èƒ½ä¼˜åŒ–** (`cleanup-orphan-processes.sh`):
  - é¢„æœŸæ¸…ç†æ—¶é—´: `8` â†’ `6` ç§’
  - æ‰¹é‡å¹¶è¡Œå¤„ç†è¿›ç¨‹ï¼Œæ˜¾è‘—æå‡æ•ˆç‡

## [0.7.0] - 2025-11-19

### Fixed

- **ğŸ è¿›ç¨‹å †ç§¯é—®é¢˜**: ä¿®å¤äº†é«˜å¼ºåº¦ä½¿ç”¨é’©å­åå¯¼è‡´å¤§é‡ node/npx è¿›ç¨‹å †ç§¯çš„ä¸¥é‡æ€§èƒ½é—®é¢˜
  - **é—®é¢˜åŸå› **:
    1. `PostToolUse` é’©å­è§¦å‘é¢‘ç‡è¿‡é«˜ï¼Œæ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½ä¼šå¯åŠ¨æ–°è¿›ç¨‹
    2. æ‰€æœ‰é’©å­ä½¿ç”¨ `pnpm dlx` æ¯æ¬¡éƒ½ä¸‹è½½åŒ…ï¼Œåˆ›å»ºå¤šä¸ªè¿›ç¨‹é“¾
    3. åå°è¿›ç¨‹ç®¡ç†ä½¿ç”¨å¼ºåˆ¶ `kill`ï¼Œå¯¼è‡´å­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹
    4. Windows å¹³å°çš„ `timeout` å‘½ä»¤æ— æ³•æ­£ç¡®æ¸…ç†è¿›ç¨‹æ ‘
  - **å½±å“èŒƒå›´**:
    - ä½¿ç”¨ 100 æ¬¡å·¥å…· = ~200 æ¬¡ `pnpm dlx` è°ƒç”¨
    - ä»»åŠ¡ç®¡ç†å™¨æ˜¾ç¤ºå¤§é‡åƒµå°¸ node.exe/npx.exe è¿›ç¨‹
    - ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œå†…å­˜å ç”¨å¢åŠ 
  - **ä¿®å¤æ–¹æ¡ˆ**:
    1. âœ… ç§»é™¤ `PostToolUse` é’©å­ï¼ˆä¿ç•™ `PreToolUse`ï¼‰
    2. âœ… æ‰€æœ‰é’©å­æ”¹ç”¨é¢„å®‰è£…çš„å…¨å±€åŒ… `claude-notifier`
    3. âœ… æ”¹è¿›åå°è¿›ç¨‹ç®¡ç†ï¼Œä¸å†å¼ºåˆ¶ kill
    4. âœ… æ–°å¢è¿›ç¨‹æ¸…ç†è„šæœ¬ `cleanup-orphan-processes.sh`

### Added

- **è¿›ç¨‹æ¸…ç†è„šæœ¬**: æ–°å¢ `cleanup-orphan-processes.sh`
  - è‡ªåŠ¨æ£€æµ‹å¹¶æ¸…ç†å­¤å„¿ node/npx è¿›ç¨‹
  - æ”¯æŒ Windows å’Œ Unix-like ç³»ç»Ÿ
  - é’ˆå¯¹æ€§æ¸…ç† claude-notifierã€geminiã€é•¿æ—¶é—´è¿è¡Œçš„ npx è¿›ç¨‹
  - åœ¨ Stop é’©å­ä¸­è‡ªåŠ¨è°ƒç”¨ï¼Œç¡®ä¿è¿›ç¨‹ä¸å †ç§¯

### Changed

- **é’©å­é…ç½®ä¼˜åŒ–**:
  - âŒ ç§»é™¤ `PostToolUse` é’©å­ï¼ˆè§¦å‘é¢‘ç‡è¿‡é«˜ï¼‰
  - âœ… ä¿ç•™ `PreToolUse` é’©å­
  - ğŸ”„ æ‰€æœ‰é’©å­å‘½ä»¤ä» `pnpm dlx @ruan-cat/claude-notifier@latest` æ”¹ä¸º `claude-notifier`
  - â• Stop é’©å­æ–°å¢æ¸…ç†è„šæœ¬è°ƒç”¨

- **åå°è¿›ç¨‹ç®¡ç†æ”¹è¿›** (`task-complete-notifier.sh`):
  - ä½¿ç”¨é¢„å®‰è£…çš„ `claude-notifier` è€Œé `pnpm dlx`
  - ä¸å†å¼ºåˆ¶ kill è¿›ç¨‹ï¼Œè®© `timeout` å‘½ä»¤è‡ªç„¶å¤„ç†è¶…æ—¶
  - ä¼˜åŒ–è¶…æ—¶æ—¶é—´ï¼š5 ç§’ â†’ 3 ç§’
  - æ”¹è¿›çš„ç­‰å¾…ç­–ç•¥ï¼Œé¿å…åˆ›å»ºå­¤å„¿è¿›ç¨‹

### Breaking Changes

âš ï¸ **éœ€è¦æ‰‹åŠ¨å®‰è£…å…¨å±€ä¾èµ–**

æœ¬ç‰ˆæœ¬æ”¹ç”¨é¢„å®‰è£…çš„å…¨å±€åŒ…ï¼Œä½¿ç”¨å‰å¿…é¡»å®‰è£…ï¼š

```bash
# å¿…éœ€ï¼šå®‰è£… claude-notifier
pnpm add -g @ruan-cat/claude-notifier
# æˆ–ä½¿ç”¨ npm
npm install -g @ruan-cat/claude-notifier

# å¿…éœ€ï¼šå®‰è£… tsx
pnpm add -g tsx

# å¯é€‰ï¼šå®‰è£… geminiï¼ˆç”¨äº AI æ‘˜è¦ï¼‰
npm install -g @google/generative-ai-cli
```

éªŒè¯å®‰è£…ï¼š

```bash
claude-notifier --version
tsx --version
gemini --version  # å¯é€‰
```

### Performance

**æ€§èƒ½æå‡**:

- è¿›ç¨‹åˆ›å»ºå‡å°‘ ~50%ï¼ˆç§»é™¤ PostToolUseï¼‰
- åƒµå°¸è¿›ç¨‹å‡ ä¹ä¸º 0ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
- å“åº”é€Ÿåº¦æ›´å¿«ï¼ˆä½¿ç”¨é¢„å®‰è£…åŒ…ï¼‰

### Technical Details

#### ä¿®å¤å‰åå¯¹æ¯”

**ä¿®å¤å‰** (hooks.json):

```json
{
	"PostToolUse": [{ "command": "pnpm dlx @ruan-cat/claude-notifier@latest ..." }],
	"PreToolUse": [{ "command": "pnpm dlx @ruan-cat/claude-notifier@latest ..." }]
}
```

- æ¯æ¬¡å·¥å…·è°ƒç”¨ = 2 æ¬¡ `pnpm dlx` = ~4-6 ä¸ªè¿›ç¨‹

**ä¿®å¤å**:

```json
{
	"PreToolUse": [{ "command": "claude-notifier ..." }],
	"Stop": [{ "command": "bash .../task-complete-notifier.sh" }, { "command": "bash .../cleanup-orphan-processes.sh" }]
}
```

- PreToolUse: 1 æ¬¡è½»é‡çº§è°ƒç”¨
- Stop: è‡ªåŠ¨æ¸…ç†å­¤å„¿è¿›ç¨‹

#### è¿›ç¨‹ç®¡ç†æ”¹è¿›

**ä¿®å¤å‰** (task-complete-notifier.sh:248-274):

```bash
# åå°è¿è¡Œï¼Œç„¶åå¼ºåˆ¶ kill
pnpm dlx ... &
NOTIFIER_PID=$!
# 6 ç§’å
kill $NOTIFIER_PID  # âŒ åªæ€çˆ¶è¿›ç¨‹ï¼Œå­è¿›ç¨‹å˜å­¤å„¿
```

**ä¿®å¤å**:

```bash
# ä½¿ç”¨é¢„å®‰è£…åŒ… + timeout è‡ªç„¶è¶…æ—¶
timeout 3s claude-notifier ... &
# ä¸å†å¼ºåˆ¶ killï¼Œè®© timeout å¤„ç†
# cleanup-orphan-processes.sh ä¼šæ¸…ç†æ®‹ç•™
```

### References

- é—®é¢˜åˆ†æï¼š`.github/prompts/index.md` (ä»»åŠ¡æˆªå›¾å’Œæ’æŸ¥è¿‡ç¨‹)
- ä¿®å¤çš„è„šæœ¬ï¼š
  - `hooks/hooks.json` (ç§»é™¤ PostToolUseï¼Œæ”¹ç”¨å…¨å±€åŒ…)
  - `scripts/task-complete-notifier.sh` (æ”¹è¿›è¿›ç¨‹ç®¡ç†)
  - `scripts/cleanup-orphan-processes.sh` (æ–°å¢)

## [0.6.7] - 2025-11-19

### Fixed

- **ğŸ Plugin Hooks é‡å¤åŠ è½½é”™è¯¯**: ä¿®å¤äº† `Duplicate hooks file detected` é”™è¯¯
  - **é—®é¢˜åŸå› **: Claude Code ä¼šè‡ªåŠ¨åŠ è½½æ ‡å‡†ä½ç½®çš„ `hooks/hooks.json`ï¼Œæ— éœ€åœ¨ `plugin.json` ä¸­æ˜¾å¼å¼•ç”¨
  - **é”™è¯¯è¡¨ç°**:
    - `Hook load failed: Duplicate hooks file detected`
    - æ’ä»¶åŠ è½½å¤±è´¥ï¼Œæ‰€æœ‰ hooks åŠŸèƒ½æ— æ³•ä½¿ç”¨
  - **ä¿®å¤æ–¹æ¡ˆ**: åˆ é™¤ `plugin.json` ä¸­çš„ `"hooks": "./hooks/hooks.json"` é…ç½®
  - **æŠ€æœ¯è¯´æ˜**:
    - Claude Code æ’ä»¶ç³»ç»Ÿä¼š**è‡ªåŠ¨åŠ è½½** `hooks/hooks.json`
    - `plugin.json` çš„ `hooks` å­—æ®µä»…ç”¨äºå¼•ç”¨**é¢å¤–çš„** hooks æ–‡ä»¶ï¼ˆéæ ‡å‡†ä½ç½®ï¼‰
    - å¼•ç”¨æ ‡å‡†ä½ç½®çš„ hooks æ–‡ä»¶ä¼šå¯¼è‡´é‡å¤åŠ è½½

## [0.6.6] - 2025-11-17

### Added

- **æ–°å¢ Agent**: `migrate-iconify-use-pure-admin` - ç”¨äºå°† pure-admin çš„ iconify å›¾æ ‡æ–¹æ¡ˆè¿ç§»åˆ°ä»»æ„ vite+vue3 é¡¹ç›®
  - å¸®åŠ©é¡¹ç›®å¿«é€Ÿé›†æˆåœ¨çº¿å’Œç¦»çº¿çš„ iconify å›¾æ ‡ç³»ç»Ÿ
  - æä¾›å®Œæ•´çš„è¿ç§»æŒ‡å—å’Œæœ€ä½³å®è·µå»ºè®®
  - æ”¯æŒç¦»çº¿å›¾æ ‡é¢„åŠ è½½ã€åœ¨çº¿å›¾æ ‡å’Œ useRenderIcon Hook

## [0.6.5] - 2025-11-17

### Fixed

- **ğŸ Hook è¾“å‡ºæ ¼å¼å…¼å®¹æ€§é—®é¢˜**: ä¿®å¤äº† Claude Code ç‰ˆæœ¬å‡çº§åå¯¼è‡´çš„ `â— Stop hook failed: The operation was aborted` é”™è¯¯
  - **é—®é¢˜åŸå› **: Claude Code æ–°ç‰ˆæœ¬æ”¹å˜äº† Hook è¾“å‡ºæ ¼å¼è§„èŒƒ
    - **æ—§æ ¼å¼**: ä½¿ç”¨ `{"decision": "approve"}` è¡¨ç¤ºå…è®¸ç»§ç»­
    - **æ–°è§„èŒƒ**: `decision` å­—æ®µåªæ¥å— `"block"` æˆ–ä¸è®¾ç½®ï¼ˆundefinedï¼‰
    - **ç»“æœ**: ä½¿ç”¨ `"approve"` å¯¼è‡´ hook è¢«ä¸­æ­¢å¹¶æŠ¥é”™
  - **å½±å“èŒƒå›´**:
    - `task-complete-notifier.sh` (Stop hook): 2 å¤„è¿”å›æ ¼å¼é”™è¯¯
    - `user-prompt-logger.sh` (UserPromptSubmit hook): 1 å¤„è¿”å›æ ¼å¼é”™è¯¯
    - æ‰€æœ‰ä½¿ç”¨è¿™äº› hooks çš„åŠŸèƒ½éƒ½ä¼šå¤±è´¥
  - **ä¿®å¤æ–¹æ¡ˆ**: æ›´æ–°ä¸ºç¬¦åˆæ–°è§„èŒƒçš„è¾“å‡ºæ ¼å¼
    - é”™è¯¯é™·é˜±: `{"decision": "approve"}` â†’ `{}`ï¼ˆç©º JSONï¼‰
    - æ­£å¸¸è¾“å‡º: `{"decision": "approve", "additionalContext": "..."}` â†’ `{"continue": true, "stopReason": "..."}`
    - UserPromptSubmit: `{"decision": "approve"}` â†’ `{}`

### Technical Details

#### Hook è¾“å‡ºæ ¼å¼è§„èŒƒå˜æ›´

æ ¹æ® Claude Code æœ€æ–°æ–‡æ¡£ï¼ˆhttps://code.claude.com/docs/en/hooks.mdï¼‰ï¼š

**Stop/SubagentStop äº‹ä»¶**:

```json
{
  "decision": "block" | undefined,  // åªæ¥å— "block" æˆ–ä¸è®¾ç½®
  "reason": "é˜»å¡åŸå› "               // decision ä¸º "block" æ—¶å¿…éœ€
}
```

**é€šç”¨å­—æ®µ**ï¼ˆæ‰€æœ‰äº‹ä»¶é€‚ç”¨ï¼‰:

```json
{
	"continue": true, // æ˜ç¡®æŒ‡ç¤ºæ˜¯å¦ç»§ç»­æ‰§è¡Œ
	"stopReason": "string" // å¯é€‰çš„åœæ­¢åŸå› è¯´æ˜
}
```

**è¦ç‚¹**:

- âŒ `"approve"` å’Œ `"proceed"` ä¸å†æ˜¯æœ‰æ•ˆçš„ decision å€¼
- âœ… å…è®¸ç»§ç»­æ—¶åº”è¯¥ä¸è®¾ç½® `decision` å­—æ®µï¼Œæˆ–ä½¿ç”¨ `{"continue": true}`
- âœ… è¿”å›ç©º JSON `{}` æˆ– exit code 0 ä¹Ÿè¡¨ç¤ºå…è®¸ç»§ç»­

#### ä¿®å¤å‰åå¯¹æ¯”

**ä¿®å¤å‰** (task-complete-notifier.sh:48, 259):

```bash
# é”™è¯¯é™·é˜±
trap 'echo "{\"decision\": \"approve\"}"; exit 0' ERR EXIT  # âŒ

# æ­£å¸¸è¾“å‡º
OUTPUT_JSON="{\"decision\": \"approve\", \"additionalContext\": \"âœ… ä»»åŠ¡æ€»ç»“: ${SUMMARY}\"}"  # âŒ
```

**ä¿®å¤å**:

```bash
# é”™è¯¯é™·é˜±
trap 'echo "{}"; exit 0' ERR EXIT  # âœ… è¿”å›ç©º JSON

# æ­£å¸¸è¾“å‡º
OUTPUT_JSON="{\"continue\": true, \"stopReason\": \"âœ… ä»»åŠ¡æ€»ç»“: ${SUMMARY}\"}"  # âœ… ä½¿ç”¨æ–°æ ¼å¼
```

**ä¿®å¤å‰** (user-prompt-logger.sh:60):

```bash
echo "{\"decision\": \"approve\"}"  # âŒ
```

**ä¿®å¤å**:

```bash
echo "{}"  # âœ… è¿”å›ç©º JSONï¼Œå…è®¸ç»§ç»­å¤„ç†
```

### Testing

ä¿®å¤ååº”è¯¥éªŒè¯ï¼š

1. Stop hook æ­£å¸¸æ‰§è¡Œï¼Œä¸å†å‡ºç° "operation was aborted" é”™è¯¯
2. UserPromptSubmit hook æ­£å¸¸æ‰§è¡Œ
3. ä»»åŠ¡å®Œæˆé€šçŸ¥åŠŸèƒ½æ­£å¸¸å·¥ä½œ
4. Gemini æ€»ç»“åŠŸèƒ½æ­£å¸¸å·¥ä½œ
5. æ—¥å¿—æ­£å¸¸è®°å½•

### References

- Claude Code Hooks æ–‡æ¡£: https://code.claude.com/docs/en/hooks.md
- ä¿®å¤çš„è„šæœ¬:
  - `scripts/task-complete-notifier.sh` (2 å¤„ä¿®å¤)
  - `scripts/user-prompt-logger.sh` (1 å¤„ä¿®å¤)

## [0.6.4] - 2025-11-07

### Changed

- **ä»»åŠ¡æ€»ç»“æç¤ºè¯ä¼˜åŒ–**: æ–°å¢å¼ºåˆ¶ä¸­æ–‡è¾“å‡ºè¦æ±‚ï¼Œç¡®ä¿ Gemini ç”Ÿæˆçš„ä»»åŠ¡æ‘˜è¦å§‹ç»ˆä½¿ç”¨ä¸­æ–‡ï¼Œé¿å…å‡ºç°è‹±æ–‡æˆ–å…¶ä»–è¯­è¨€

## [0.6.3] - 2025-11-07

### Fixed

- **ğŸ å¯¹è¯å†å²è§£ææ ¼å¼é”™è¯¯**: ä¿®å¤äº† transcript-reader.ts æ— æ³•æ­£ç¡®è§£æ Claude Code transcript.jsonl æ–‡ä»¶æ ¼å¼çš„å…³é”®é—®é¢˜
  - **é—®é¢˜åŸå› **: è§£æé€»è¾‘æœŸæœ›çš„æ¶ˆæ¯æ ¼å¼ä¸ Claude Code å®é™…ç”Ÿæˆçš„æ ¼å¼ä¸åŒ¹é…
    - **æœŸæœ›æ ¼å¼**: æ¯è¡Œç›´æ¥æ˜¯ `{role: "user", content: "..."}`
    - **å®é™…æ ¼å¼**: æ¯è¡Œæ˜¯ `{type: "user", message: {role: "user", content: "..."}}`
  - **å½±å“èŒƒå›´**:
    - `analyzeConversation` å‡½æ•°æ— æ³•æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆæ¶ˆæ¯
    - `userMessages` å’Œ `assistantMessages` æ•°ç»„å§‹ç»ˆä¸ºç©º
    - `generateSummary` æ€»æ˜¯è¿”å›é»˜è®¤å€¼ "ä»»åŠ¡å¤„ç†å®Œæˆ"
    - é’©å­æ— æ³•æå–æœ‰æ•ˆçš„å¯¹è¯ä¸Šä¸‹æ–‡ä¾› Gemini ä½¿ç”¨
  - **ä¿®å¤æ–¹æ¡ˆ**:
    1. æ–°å¢ `TranscriptLine` æ¥å£å®šä¹‰çœŸå®çš„ JSONL æ ¼å¼
    2. ä¿®æ”¹ `readTranscript` å‡½æ•°æ­£ç¡®è§£æåµŒå¥—çš„æ¶ˆæ¯ç»“æ„
    3. åªæå– `type === "user"` æˆ– `type === "assistant"` çš„è¡Œ
    4. ä» `transcriptLine.message` ä¸­è·å–çœŸæ­£çš„æ¶ˆæ¯å¯¹è±¡

### Technical Details

#### ä¿®å¤å‰çš„è§£æé€»è¾‘

```typescript
// é”™è¯¯ï¼šç›´æ¥è§£æä¸º Messageï¼ŒæœŸæœ›é¡¶å±‚å°±æœ‰ role å­—æ®µ
const msg = JSON.parse(line) as Message;
messages.push(msg);

// analyzeConversation æ£€æŸ¥
if (msg.role === "user") { ... }  // âŒ role ä¸åœ¨é¡¶å±‚
```

#### ä¿®å¤åçš„è§£æé€»è¾‘

```typescript
// æ­£ç¡®ï¼šå…ˆè§£æä¸º TranscriptLineï¼Œå†æå–åµŒå¥—çš„ message
const transcriptLine = JSON.parse(line) as TranscriptLine;

if ((transcriptLine.type === "user" || transcriptLine.type === "assistant") && transcriptLine.message) {
	messages.push(transcriptLine.message); // âœ… æå–çœŸæ­£çš„æ¶ˆæ¯å¯¹è±¡
}
```

#### Claude Code å®é™…çš„ transcript.jsonl æ ¼å¼

```json
{
  "type": "user",
  "message": {
    "role": "user",
    "content": "ä½ å¥½ï¼Ÿä½ æ˜¯ä»€ä¹ˆæ¨¡å‹å•Šï¼Ÿ"
  },
  "uuid": "3c37859f-a9f2-40aa-a98c-9edc831847d9",
  "timestamp": "2025-11-06T21:06:26.835Z"
}

{
  "type": "assistant",
  "message": {
    "role": "assistant",
    "content": [
      {"type": "text", "text": "ä½ å¥½ï¼æˆ‘æ˜¯ Claude Code..."}
    ],
    "model": "kimi-k2-turbo-preview"
  },
  "uuid": "5ff8f34b-b284-4229-970b-bab98195825a"
}
```

### Testing

æµ‹è¯•ç»“æœç¡®è®¤ä¿®å¤æˆåŠŸï¼š

**æµ‹è¯•æ–‡ä»¶ 1**: `d2de3058-8439-4374-803c-0db866cb1ede.jsonl`

```plain
âœ… ä¿®å¤å‰: "ä»»åŠ¡å¤„ç†å®Œæˆ" (6 å­—ç¬¦)
âœ… ä¿®å¤å: "ä½ å¥½ï¼Ÿä½ æ˜¯ä»€ä¹ˆæ¨¡å‹å•Šï¼Ÿ\n\næˆ‘æ˜¯ Claude Codeï¼Œä½¿ç”¨çš„æ˜¯ Claude 3.5 Sonnet æ¨¡å‹ã€‚"
```

**æµ‹è¯•æ–‡ä»¶ 2**: `300b35d9-f468-4005-9811-2f6edf73b351.jsonl`

```plain
âœ… ä¿®å¤å‰: "ä»»åŠ¡å¤„ç†å®Œæˆ" (6 å­—ç¬¦)
âœ… ä¿®å¤å: "è¿è¡Œ vue-tsc --build å‘½ä»¤...\n\nå·²å®Œæˆç±»å‹æ£€æŸ¥ï¼Œå‘ç° 403 ä¸ªç±»å‹é”™è¯¯..."
```

**å…³é”®è¯æå–æµ‹è¯•**:

```bash
tsx transcript-reader.ts <file> --format=keywords
âœ… è¾“å‡º: "Claude, ä½ å¥½, æˆ‘æ˜¯, Code, Sonnet, æ¨¡å‹, ..."
```

### References

- ä¿®å¤çš„è„šæœ¬ï¼š`scripts/transcript-reader.ts:43-48, 186-213`
- ç›¸å…³æ—¥å¿—åˆ†æï¼š
  - `C:\Users\pc\AppData\Local\Temp\claude-code-task-complete-notifier-logs\2025-11-07__00-03-46__*.log`
  - æ‰€æœ‰æ—¥å¿—æ˜¾ç¤º "Extracted Context Length: 6 characters" (ä»…åŒ…å«é»˜è®¤æ–‡æœ¬)

## [0.6.2] - 2025-11-06

### Fixed

- **ğŸ é’©å­ä¸Šä¸‹æ–‡è¯»å–å¤±è´¥**: ä¿®å¤äº† transcript-reader.js å›  ES Module é”™è¯¯æ— æ³•è¯»å–å¯¹è¯ä¸Šä¸‹æ–‡çš„é—®é¢˜
  - **é—®é¢˜åŸå› **: `transcript-reader.js` ä½¿ç”¨ CommonJS çš„ `require()` è¯­æ³•ï¼Œä½†çˆ¶çº§ package.json è®¾ç½®äº† `"type": "module"`
  - **é”™è¯¯ä¿¡æ¯**: `ReferenceError: require is not defined in ES module scope`
  - **å½±å“èŒƒå›´**:
    - `task-complete-notifier.sh`: æ— æ³•æå–å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´ Gemini æ€»ç»“å¤±è´¥
    - æ‰€æœ‰æ—¥å¿—æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œéæœ‰æ•ˆçš„ä»»åŠ¡æ‘˜è¦
  - **ä¿®å¤æ–¹æ¡ˆ**:
    1. å°† `transcript-reader.js` æ”¹ä¸º `transcript-reader.ts`ï¼Œä½¿ç”¨ TypeScript + ES Module
    2. åˆ›å»º `parse-hook-data.ts` è§£æé’©å­ JSON è¾“å…¥ï¼ˆæ”¯æŒ Windows è·¯å¾„è½¬ä¹‰ï¼‰
    3. ä½¿ç”¨å…¨å±€ `tsx` å‘½ä»¤è¿è¡Œ TypeScript æ–‡ä»¶
    4. æ·»åŠ é™çº§æœºåˆ¶ï¼štsx ä¸å­˜åœ¨æ—¶ä½¿ç”¨ grep/sed æå–

### Changed

- **è„šæœ¬è¿ç§»è‡³ TypeScript**:
  - `transcript-reader.js` â†’ `transcript-reader.ts`
  - æ–°å¢ `parse-hook-data.ts` ç”¨äº JSON è§£æ
  - æ·»åŠ å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
  - æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

- **Windows è·¯å¾„æ”¯æŒå¢å¼º**:
  - ä¿®å¤ JSON è§£æå™¨æ— æ³•å¤„ç† Windows è·¯å¾„ä¸­çš„åæ–œæ é—®é¢˜
  - å®ç°æ™ºèƒ½è½¬ä¹‰ï¼šè‡ªåŠ¨å°†å•åæ–œæ è½¬ä¸ºåŒåæ–œæ 
  - å…¼å®¹ Git Bash å’Œ PowerShell ç¯å¢ƒ

### Technical Details

#### ä¿®å¤å‰çš„é”™è¯¯

æ—¥å¿—æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯ï¼š

```plain
file:///C:/Users/pc/.claude/plugins/.../transcript-reader.js:15
const fs = require("fs");
           ^
ReferenceError: require is not defined in ES module scope
```

Gemini æ”¶åˆ°çš„æ˜¯é”™è¯¯ä¿¡æ¯è€Œéä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´æ€»ç»“å¤±è´¥ã€‚

#### ä¿®å¤åçš„å®ç°

**æ–°æ–‡ä»¶ç»“æ„**ï¼š

- `transcript-reader.ts` - TypeScript ç‰ˆæœ¬ï¼Œä½¿ç”¨ `import` è¯­æ³•
- `parse-hook-data.ts` - JSON è§£æå™¨ï¼Œå¤„ç† Windows è·¯å¾„è½¬ä¹‰

**è¿è¡Œæ–¹å¼**ï¼š

```bash
# ä½¿ç”¨ tsx è¿è¡Œ TypeScript æ–‡ä»¶
tsx transcript-reader.ts "$TRANSCRIPT_PATH" --format=summary
tsx parse-hook-data.ts session_id < hook-data.json
```

**é™çº§ç­–ç•¥**ï¼š

```bash
# æ£€æŸ¥ tsx æ˜¯å¦å¯ç”¨
if command -v tsx &> /dev/null; then
  # ä½¿ç”¨ TypeScript ç‰ˆæœ¬
  tsx transcript-reader.ts "$TRANSCRIPT_PATH" --format=summary
else
  # è®°å½• tsx ä¸å­˜åœ¨çš„æƒ…å†µåˆ°æ—¥å¿—
  log "WARNING: tsx not available, using default summary"
  SUMMARY="ä»»åŠ¡å¤„ç†å®Œæˆ"
fi
```

#### Windows è·¯å¾„è½¬ä¹‰é—®é¢˜

**é—®é¢˜**ï¼šé’©å­ä¼ å…¥çš„ JSON åŒ…å«æœªè½¬ä¹‰çš„åæ–œæ 

```json
{ "transcript_path": "C:\Users\pc\.claude\projects\..." }
```

**è§£å†³æ–¹æ¡ˆ**ï¼šæ™ºèƒ½è½¬ä¹‰ç®—æ³•

```typescript
// 1. æš‚å­˜å·²è½¬ä¹‰çš„åŒåæ–œæ 
input = input.replace(/\\\\/g, "\x00");
// 2. å°†æ‰€æœ‰å•åæ–œæ è½¬ä¸ºåŒåæ–œæ 
input = input.replace(/\\/g, "\\\\");
// 3. æ¢å¤åŒåæ–œæ 
input = input.replace(/\x00/g, "\\\\");
```

### Testing

æµ‹è¯•ç»“æœç¡®è®¤ä¿®å¤æˆåŠŸï¼š

- âœ… JSON è§£ææ­£å¸¸ï¼ˆSession IDã€Transcript Path æ­£ç¡®æå–ï¼‰
- âœ… transcript-reader.ts æˆåŠŸæ‰§è¡Œ
- âœ… å¯¹è¯ä¸Šä¸‹æ–‡æ­£ç¡®æå–
- âœ… Gemini æ€»ç»“åŠŸèƒ½æ¢å¤æ­£å¸¸
- âœ… Windows è·¯å¾„æ­£ç¡®å¤„ç†

### References

- ä¿®å¤çš„è„šæœ¬ï¼š
  - `scripts/transcript-reader.ts` (æ–°)
  - `scripts/parse-hook-data.ts` (æ–°)
  - `scripts/task-complete-notifier.sh` (æ›´æ–°)
- åˆ é™¤çš„æ–‡ä»¶ï¼š
  - `scripts/transcript-reader.js` (å·²åºŸå¼ƒ)

## [0.6.1] - 2025-11-04

### Fixed

- **ğŸ é’©å­å†³ç­–ç±»å‹é”™è¯¯**: ä¿®å¤äº†é’©å­è¿”å›å€¼å¯¼è‡´ Claude Code å†…éƒ¨æ•…éšœçš„ä¸¥é‡é—®é¢˜
  - **é—®é¢˜åŸå› **: é’©å­è„šæœ¬è¿”å›äº† `{"decision": "proceed"}`ï¼Œä½† Claude Code åªæ¥å— `approve` æˆ– `block` ä¸¤ç§å†³ç­–ç±»å‹
  - **é”™è¯¯ä¿¡æ¯**: `Error: Unknown hook decision type: proceed. Valid types are: approve, block`
  - **å½±å“èŒƒå›´**:
    - `user-prompt-logger.sh`: UserPromptSubmit é’©å­æ— æ³•æ­£å¸¸å·¥ä½œ
    - `task-complete-notifier.sh`: Stop é’©å­å¯¼è‡´ Claude Code å´©æºƒ
  - **ä¿®å¤æ–¹æ¡ˆ**: å°†æ‰€æœ‰é’©å­è„šæœ¬çš„è¿”å›å€¼ä» `"proceed"` æ”¹ä¸º `"approve"`
    - `user-prompt-logger.sh:60`: å¿«é€Ÿè¿”å›æ—¶çš„å†³ç­–ç±»å‹
    - `task-complete-notifier.sh:48`: é”™è¯¯é™·é˜±ä¸­çš„å†³ç­–ç±»å‹
    - `task-complete-notifier.sh:247`: æ­£å¸¸è¾“å‡ºæ—¶çš„å†³ç­–ç±»å‹

### Technical Details

#### ä¿®å¤å‰çš„ä»£ç ï¼ˆå¯¼è‡´å´©æºƒï¼‰

```bash
# user-prompt-logger.sh:60
echo "{\"decision\": \"proceed\"}"  # âŒ é”™è¯¯çš„å†³ç­–ç±»å‹

# task-complete-notifier.sh:48
trap 'echo "{\"decision\": \"proceed\"}"; exit 0' ERR EXIT  # âŒ é”™è¯¯çš„å†³ç­–ç±»å‹

# task-complete-notifier.sh:247
OUTPUT_JSON="{\"decision\": \"proceed\", ...}"  # âŒ é”™è¯¯çš„å†³ç­–ç±»å‹
```

#### ä¿®å¤åçš„ä»£ç ï¼ˆæ­£å¸¸å·¥ä½œï¼‰

```bash
# user-prompt-logger.sh:60
echo "{\"decision\": \"approve\"}"  # âœ… æ­£ç¡®çš„å†³ç­–ç±»å‹

# task-complete-notifier.sh:48
trap 'echo "{\"decision\": \"approve\"}"; exit 0' ERR EXIT  # âœ… æ­£ç¡®çš„å†³ç­–ç±»å‹

# task-complete-notifier.sh:247
OUTPUT_JSON="{\"decision\": \"approve\", ...}"  # âœ… æ­£ç¡®çš„å†³ç­–ç±»å‹
```

#### é’©å­å†³ç­–ç±»å‹è§„èŒƒ

æ ¹æ® Claude Code å®˜æ–¹æ–‡æ¡£ï¼Œé’©å­è¿”å›çš„ JSON å¿…é¡»åŒ…å« `decision` å­—æ®µï¼Œä¸”åªæ”¯æŒä¸¤ç§å€¼ï¼š

| å†³ç­–ç±»å‹  | è¯´æ˜                       | ä½¿ç”¨åœºæ™¯                     |
| --------- | -------------------------- | ---------------------------- |
| `approve` | å…è®¸æ“ä½œç»§ç»­               | æ­£å¸¸æ‰§è¡Œï¼Œä¸é˜»å¡ Claude Code |
| `block`   | é˜»æ­¢æ“ä½œç»§ç»­ï¼Œæ˜¾ç¤ºé˜»å¡æ¶ˆæ¯ | éœ€è¦ç”¨æˆ·ç¡®è®¤æˆ–æ»¡è¶³ç‰¹å®šæ¡ä»¶   |

**é‡è¦**: `proceed` ä¸æ˜¯æœ‰æ•ˆçš„å†³ç­–ç±»å‹ï¼Œä¼šå¯¼è‡´ Claude Code æŠ›å‡ºå¼‚å¸¸å¹¶å´©æºƒã€‚

### References

- ä¿®å¤çš„è„šæœ¬ï¼š
  - `scripts/user-prompt-logger.sh`
  - `scripts/task-complete-notifier.sh`
- å®˜æ–¹æ–‡æ¡£ï¼š[Claude Code Hooks Reference](https://docs.claude.com/en/docs/claude-code/hooks)

## [0.6.0] - 2025-11-04

### Added

- **å®Œæ•´å¯¹è¯å†å²è¯»å–**: æ–°å¢ `transcript-reader.js` JSONL è§£æå™¨
  - è¯»å–å®Œæ•´çš„å¯¹è¯å†å²ï¼Œä¸å†é™åˆ¶æ¶ˆæ¯æ•°é‡
  - æ”¯æŒä¸‰ç§è¾“å‡ºæ ¼å¼ï¼šsummaryï¼ˆæ‘˜è¦ï¼‰ã€fullï¼ˆå®Œæ•´ï¼‰ã€keywordsï¼ˆå…³é”®è¯ï¼‰
  - æ™ºèƒ½æå–ç”¨æˆ·æ¶ˆæ¯ã€Agent å“åº”ã€å·¥å…·è°ƒç”¨ä¿¡æ¯
  - æ™ºèƒ½æˆªæ–­é•¿æ–‡æœ¬ï¼Œé¿å…è¶…è¿‡ Gemini token é™åˆ¶

- **åŒé’©å­åä½œæœºåˆ¶**: å®ç° UserPromptSubmit å’Œ Stop é’©å­åä½œ
  - `user-prompt-logger.sh`: åœ¨ UserPromptSubmit é’©å­ä¸­åˆå§‹åŒ–ä¼šè¯æ—¥å¿—ï¼Œè®°å½•ç”¨æˆ·è¾“å…¥
  - `task-complete-notifier.sh`: åœ¨ Stop é’©å­ä¸­è¯»å–å®Œæ•´ä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆæ€»ç»“
  - å¿«é€Ÿè¿”å›ï¼ˆUserPromptSubmit < 1sï¼ŒStop < 15sï¼‰ï¼Œä¸é˜»å¡ Claude Code

- **å¢å¼ºçš„æ€»ç»“ç”Ÿæˆ**: æ”¹è¿› Gemini æ€»ç»“ç­–ç•¥
  - åŸºäºå®Œæ•´å¯¹è¯å†å²ç”Ÿæˆä¸Šä¸‹æ–‡ï¼ˆä¸å†åªè¯»å–æœ€å 5 æ¡ï¼‰
  - ä¸‰çº§é™çº§ç­–ç•¥ï¼šgemini-2.5-flash â†’ gemini-2.5-pro â†’ å…³é”®è¯æå–
  - æå–ç¬¬ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ã€æœ€è¿‘äº¤äº’ã€æœ€åå“åº”ï¼Œæ„å»ºç»“æ„åŒ–ä¸Šä¸‹æ–‡
  - æ›´å‡†ç¡®çš„æ€»ç»“ç»“æœï¼Œæ˜¾è‘—å‡å°‘"ä»»åŠ¡å¤„ç†å®Œæˆ"çš„ç©ºæ´æ‘˜è¦

### Changed

- **ä¸Šä¸‹æ–‡æå–ä¼˜åŒ–**: ä»"è¯»å–æœ€å 5 æ¡ï¼Œæ¯æ¡ 500 å­—ç¬¦"æ”¹ä¸º"è¯»å–å…¨éƒ¨ï¼Œæ™ºèƒ½æˆªæ–­"
  - æ—§å®ç°ï¼š`lines.slice(-5)` + `substring(0, 500)`
  - æ–°å®ç°ï¼šè¯»å–æ‰€æœ‰æ¶ˆæ¯ï¼ŒæŒ‰é‡è¦æ€§æ™ºèƒ½æˆªæ–­ï¼ˆç¬¬ä¸€ä¸ªè¯·æ±‚ 800 å­—ç¬¦ï¼Œæœ€è¿‘äº¤äº’ 600 å­—ç¬¦ï¼Œæœ€åå“åº” 800 å­—ç¬¦ï¼‰
  - æ€»ä¸Šä¸‹æ–‡é™åˆ¶ï¼š3000 å­—ç¬¦ï¼ˆå¯é…ç½®ï¼‰

- **æ—¥å¿—è®°å½•å¢å¼º**: æ›´è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯
  - è®°å½•æå–çš„ä¸Šä¸‹æ–‡é•¿åº¦
  - è®°å½• Gemini åŸå§‹è¾“å‡ºï¼ˆä¾¿äºè°ƒè¯•ï¼‰
  - è®°å½•æ¯æ¬¡å°è¯•çš„ç»“æœå’Œè€—æ—¶

- **é’©å­é…ç½®æ›´æ–°**: åœ¨ hooks.json ä¸­æ·»åŠ  UserPromptSubmit é’©å­
  - ä¿ç•™åŸæœ‰çš„æ‰€æœ‰é’©å­é…ç½®
  - æ·»åŠ  `user-prompt-logger.sh` åˆ° UserPromptSubmit
  - æ›´æ–° Stop é’©å­è¶…æ—¶æ—¶é—´ä¸º 15 ç§’

### Fixed

- **ä¸Šä¸‹æ–‡ç¼ºå¤±é—®é¢˜**: ä¿®å¤ Gemini æ€»ç»“æ€»æ˜¯ç”Ÿæˆ"ä»»åŠ¡å¤„ç†å®Œæˆ"çš„æ ¹æœ¬åŸå› 
  - é—®é¢˜åŸå› ï¼šåªè¯»å–æœ€å 5 æ¡æ¶ˆæ¯ä¸”æ¯æ¡åªæˆªå– 500 å­—ç¬¦ï¼Œå¯¼è‡´ä¸Šä¸‹æ–‡ä¸è¶³
  - è§£å†³æ–¹æ¡ˆï¼šè¯»å–å®Œæ•´å¯¹è¯å†å²ï¼Œæ™ºèƒ½æå–å…³é”®éƒ¨åˆ†
  - ç»“æœï¼šGemini ç°åœ¨èƒ½åŸºäºå®Œæ•´ä¸Šä¸‹æ–‡ç”Ÿæˆæœ‰æ„ä¹‰çš„æ€»ç»“

- **å…³é”®è¯æå–æ”¹è¿›**: ä¼˜åŒ–é™çº§ç­–ç•¥ä¸­çš„å…³é”®è¯æå–
  - ç§»é™¤å¸¸è§åœç”¨è¯ï¼ˆä¸­æ–‡å’Œè‹±æ–‡ï¼‰
  - ç»Ÿè®¡è¯é¢‘ï¼Œè¿”å›å‰ 10 ä¸ªé«˜é¢‘å…³é”®è¯
  - ä½œä¸º Gemini å¤±è´¥æ—¶çš„å…œåº•æ–¹æ¡ˆ

### Technical Details

#### æ–°å¢æ–‡ä»¶

1. **transcript-reader.js** - å¯¹è¯å†å²è§£æå™¨

   ```javascript
   // ä½¿ç”¨æ–¹å¼
   node transcript-reader.js /path/to/transcript.jsonl --format=summary
   ```

2. **user-prompt-logger.sh** - UserPromptSubmit é’©å­
   ```bash
   # è®°å½•åˆ°ä¼šè¯æ—¥å¿—
   session_{SESSION_ID}_{TIMESTAMP}.log
   ```

#### æ ¸å¿ƒæ”¹è¿›å¯¹æ¯”

| å¯¹æ¯”é¡¹     | v0.5.1                   | v0.6.0                          |
| ---------- | ------------------------ | ------------------------------- |
| ä¸Šä¸‹æ–‡è¯»å– | æœ€å 5 æ¡ï¼Œæ¯æ¡ 500 å­—ç¬¦ | å®Œæ•´å†å²ï¼Œæ™ºèƒ½æˆªæ–­ 3000 å­—ç¬¦    |
| é’©å­æ•°é‡   | 1 ä¸ªï¼ˆStopï¼‰             | 2 ä¸ªï¼ˆUserPromptSubmit + Stopï¼‰ |
| è§£ææ–¹å¼   | å†…è” Node.js è„šæœ¬        | ç‹¬ç«‹ transcript-reader.js       |
| æ€»ç»“è´¨é‡   | ç»å¸¸è¿”å›"ä»»åŠ¡å¤„ç†å®Œæˆ"   | åŸºäºå®Œæ•´ä¸Šä¸‹æ–‡çš„æœ‰æ„ä¹‰æ€»ç»“      |

#### æ¶æ„è®¾è®¡

```plain
UserPromptSubmit  â”€â”€â†’  user-prompt-logger.sh
                        â”œâ”€ åˆå§‹åŒ–ä¼šè¯æ—¥å¿—
                        â””â”€ è®°å½•ç”¨æˆ·è¾“å…¥

[Claude Code å¤„ç†ä¸­...]

Stop              â”€â”€â†’  task-complete-notifier.sh
                        â”œâ”€ è°ƒç”¨ transcript-reader.js
                        â”œâ”€ ç”Ÿæˆ Gemini æ€»ç»“
                        â””â”€ å‘é€æ¡Œé¢é€šçŸ¥
```

### Migration Guide

æ— éœ€æ‰‹åŠ¨è¿ç§»ã€‚æ›´æ–°åˆ° 0.6.0 åï¼Œæ‰€æœ‰æ”¹è¿›å°†è‡ªåŠ¨ç”Ÿæ•ˆï¼š

1. UserPromptSubmit é’©å­ä¼šè‡ªåŠ¨å¼€å§‹è®°å½•ç”¨æˆ·è¾“å…¥
2. Stop é’©å­ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„è§£æå™¨è¯»å–å®Œæ•´ä¸Šä¸‹æ–‡
3. Gemini æ€»ç»“è´¨é‡å°†æ˜¾è‘—æå‡

### References

- è®¾è®¡æ–‡æ¡£ï¼š`docs/reports/2025-11-04-claude-code-conversation-context-improvement.md`
- æ ¸å¿ƒè„šæœ¬ï¼š`scripts/transcript-reader.js`, `scripts/user-prompt-logger.sh`
- æ”¹è¿›çš„ Stop é’©å­ï¼š`scripts/task-complete-notifier.sh`

## [0.5.1] - 2025-11-03

### Fixed

- **ğŸ Stop hook é˜»å¡é—®é¢˜**: ä¿®å¤äº† `â— Stop hook prevented continuation` å¯¼è‡´ Claude Code æ— æ³•ç»§ç»­æ‰§è¡Œçš„ä¸¥é‡é—®é¢˜
  - **é—®é¢˜åŸå›  1**ï¼š`tee` å‘½ä»¤å¯¼è‡´ I/O ç®¡é“é˜»å¡
    - åœ¨ Gemini API è°ƒç”¨ä¸­ä½¿ç”¨ `2>&1 | tee -a "$LOG_FILE"` åŒæ—¶è®°å½•æ—¥å¿—å’Œæ•è·è¾“å‡º
    - ç®¡é“æ“ä½œåœ¨ Windows Git Bash ç¯å¢ƒä¸­å¯èƒ½æŒ‚èµ·
  - **é—®é¢˜åŸå›  2**ï¼š`pnpm dlx` è°ƒç”¨æŒ‚èµ·
    - é€šçŸ¥å™¨ä½¿ç”¨ `pnpm dlx` å¯èƒ½éœ€è¦ä¸‹è½½åŒ…ï¼Œæ—¶é—´ä¸å¯æ§
    - Windows ç¯å¢ƒä¸‹ `timeout` å‘½ä»¤å¯¹è¿›ç¨‹ç»„çš„æ§åˆ¶ä¸å¯é 
  - **é—®é¢˜åŸå›  3**ï¼šç¼ºå°‘å…¨å±€é”™è¯¯å¤„ç†
    - æ²¡æœ‰é”™è¯¯é™·é˜±ç¡®ä¿è„šæœ¬æ€»æ˜¯è¿”å›æˆåŠŸ
    - å¼‚å¸¸æƒ…å†µä¸‹ä¼šé˜»å¡ Claude Code

- **ä¿®å¤æ–¹æ¡ˆ**ï¼š
  1. ç§»é™¤ `tee` å‘½ä»¤ï¼Œæ”¹ç”¨åˆ†ç¦»çš„æ—¥å¿—è®°å½•æ–¹å¼
     - å…ˆæ•è·å®Œæ•´è¾“å‡ºåˆ°å˜é‡
     - å†åˆ†åˆ«å†™å…¥æ—¥å¿—æ–‡ä»¶å’Œæå–ç»“æœ
     - é¿å…ç®¡é“é˜»å¡
  2. é€šçŸ¥å™¨åå°è¿è¡Œ
     - ä½¿ç”¨å­è¿›ç¨‹ `(...)&` åœ¨åå°æ‰§è¡Œ
     - ä¸ç­‰å¾…é€šçŸ¥å™¨å®Œæˆï¼Œä¸»è„šæœ¬ç«‹å³ç»§ç»­
     - æ·»åŠ  8 ç§’è¶…æ—¶ä¿æŠ¤
  3. æ·»åŠ é”™è¯¯é™·é˜±
     - ä½¿ç”¨ `trap` æ•è· `ERR` å’Œ `EXIT` ä¿¡å·
     - ç¡®ä¿è„šæœ¬æ€»æ˜¯è¿”å› `{"decision": "proceed"}`
     - é˜²æ­¢å¼‚å¸¸å¯¼è‡´ hook é˜»å¡
  4. ä¼˜åŒ–è¶…æ—¶æ—¶é—´
     - Gemini flash: 5sï¼ˆå¿«é€Ÿå“åº”ï¼‰
     - Gemini pro: 5sï¼ˆä» 8s ä¼˜åŒ–ï¼‰
     - Default model: 4sï¼ˆæ›´çŸ­è¶…æ—¶ï¼‰
     - é€šçŸ¥å™¨: 8sï¼ˆåå°è¿è¡Œï¼‰

- **æµ‹è¯•ç»“æœ**ï¼š
  - âœ… è„šæœ¬åœ¨çº¦ 17 ç§’å†…å®Œæˆï¼ˆåŒ…æ‹¬ 3 æ¬¡ Gemini è°ƒç”¨ï¼‰
  - âœ… è¿”å›æœ‰æ•ˆçš„ JSON è¾“å‡ºï¼š`{"decision": "proceed", "additionalContext": "..."}`
  - âœ… å³ä½¿ Gemini å’Œé€šçŸ¥å™¨å¤±è´¥ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿”å›
  - âœ… ä¸å†é˜»å¡ Claude Code

### Technical Details

#### ä¿®å¤å‰çš„ä»£ç ï¼ˆä¼šé˜»å¡ï¼‰

```bash
# é—®é¢˜ 1: tee å‘½ä»¤å¯¼è‡´ç®¡é“é˜»å¡
SUMMARY=$(timeout 5s gemini ... 2>&1 | tee -a "$LOG_FILE" | head -n 1)

# é—®é¢˜ 2: pnpm dlx å¯èƒ½æŒ‚èµ·ï¼Œä¸”ç­‰å¾…å®Œæˆ
NOTIFIER_OUTPUT=$(pnpm dlx @ruan-cat/claude-notifier@latest task-complete --message "$SUMMARY" 2>&1)

# é—®é¢˜ 3: ç¼ºå°‘é”™è¯¯å¤„ç†
# å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œè„šæœ¬å°±ä¼šæŒ‚èµ·æˆ–è¿”å›é”™è¯¯
```

#### ä¿®å¤åçš„ä»£ç ï¼ˆä¸é˜»å¡ï¼‰

```bash
# ä¿®å¤ 1: åˆ†ç¦»æ—¥å¿—è®°å½•å’Œè¾“å‡ºæ•è·
GEMINI_OUTPUT=$(timeout 5s gemini ... 2>&1 || echo "")
echo "$GEMINI_OUTPUT" >> "$LOG_FILE" 2>/dev/null || true
SUMMARY=$(echo "$GEMINI_OUTPUT" | head -n 1 | tr -d '\n')

# ä¿®å¤ 2: é€šçŸ¥å™¨åå°è¿è¡Œ
(
  cd "$PROJECT_DIR" 2>/dev/null || cd /
  timeout 8s pnpm dlx @ruan-cat/claude-notifier@latest task-complete --message "$SUMMARY" >> "$LOG_FILE" 2>&1
) &
log "Notifier started in background (PID: $!)"

# ä¿®å¤ 3: é”™è¯¯é™·é˜±ç¡®ä¿æ€»æ˜¯æˆåŠŸè¿”å›
trap 'log "Script interrupted, returning success"; echo "{\"decision\": \"proceed\"}"; exit 0' ERR EXIT
```

### References

- é—®é¢˜åˆ†æï¼šå‚è§ `.github/prompts/index.md` ç¬¬ 86-151 è¡Œ
- ä¿®å¤ä»£ç ï¼š`scripts/task-complete-notifier.sh`

## [0.5.0] - 2025-11-03

### Added

- **å®Œæ•´æ—¥å¿—è®°å½•æœºåˆ¶**: æ–°å¢è‡ªåŠ¨æ—¥å¿—è®°å½•ç³»ç»Ÿ
  - æ—¥å¿—ä½ç½®ï¼š`%TEMP%\claude-code-task-complete-notifier-logs\`ï¼ˆWindowsï¼‰æˆ– `/tmp/claude-code-task-complete-notifier-logs/`ï¼ˆLinux/Macï¼‰
  - æ—¥å¿—æ–‡ä»¶å‘½åï¼š`YYYY-MM-DD__HH-mm-ss__å·¥ä½œç›®å½•.log`
  - è®°å½•å†…å®¹ï¼šHook è¾“å…¥æ•°æ®ã€å¯¹è¯ä¸Šä¸‹æ–‡ã€Gemini promptã€å“åº”ã€æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
  - æ—¥å¿—å‡½æ•°ï¼š`log()` å‡½æ•°åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶

- **å¯¹è¯å†å²è§£æåŠŸèƒ½**: ä» `transcript_path` è¯»å–å¯¹è¯å†å²
  - æ”¯æŒ JSONL æ ¼å¼è§£æï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰
  - æå–æœ€è¿‘ 5 æ¡æ¶ˆæ¯çš„ç”¨æˆ·å’ŒåŠ©æ‰‹å†…å®¹
  - é™åˆ¶æ¯æ¡æ¶ˆæ¯ 500 å­—ç¬¦ï¼Œé¿å… prompt è¿‡é•¿
  - æ™ºèƒ½ç»„åˆæˆæœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡æ‘˜è¦

- **å¤šæ¨¡å‹é™çº§ç­–ç•¥**: å®ç°ä¸‰çº§æ¨¡å‹é€‰æ‹©æœºåˆ¶
  - çº§åˆ« 1ï¼š`gemini-2.5-flash`ï¼ˆ5 ç§’è¶…æ—¶ï¼Œå¿«é€Ÿå“åº”ï¼‰
  - çº§åˆ« 2ï¼š`gemini-2.5-pro`ï¼ˆ8 ç§’è¶…æ—¶ï¼Œé«˜è´¨é‡æ€»ç»“ï¼‰
  - çº§åˆ« 3ï¼šé»˜è®¤æ¨¡å‹ï¼ˆ5 ç§’è¶…æ—¶ï¼‰
  - é™çº§ç­–ç•¥ï¼šä½¿ç”¨å¯¹è¯ä¸Šä¸‹æ–‡å‰ 50 å­—ç¬¦

- **æ‰§è¡Œæ—¶é—´ç»Ÿè®¡**: è®°å½•æ¯ä¸ª Gemini è°ƒç”¨çš„æ‰§è¡Œæ—¶é—´
  - å¸®åŠ©åˆ†æå’Œä¼˜åŒ–æ¨¡å‹é€‰æ‹©
  - ç›‘æ§æ€§èƒ½è¡¨ç°

- **è¯¦ç»†åŠŸèƒ½æ–‡æ¡£**: æ–°å¢ `TASK_COMPLETE_NOTIFIER_README.md`
  - å®Œæ•´çš„é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆè¯´æ˜
  - æ¨¡å‹é€‰æ‹©å»ºè®®å’Œæ€§èƒ½å¯¹æ¯”
  - ä½¿ç”¨æ–¹æ³•å’Œè°ƒè¯•æŒ‡å—
  - ç¤ºä¾‹æ—¥å¿—å±•ç¤º

### Fixed

- **ğŸ æ ¸å¿ƒé—®é¢˜ä¿®å¤**: ä¿®å¤äº† Gemini æ€»ç»“æ€»æ˜¯è¿”å›"ä»»åŠ¡å·²å®Œæˆ"çš„æ ¹æœ¬é—®é¢˜
  - **é—®é¢˜åŸå› **ï¼šStop é’©å­ä¸åŒ…å« `tool_input` å­—æ®µ
  - **åŸå§‹ä»£ç **ï¼šé”™è¯¯åœ°å°è¯•ä» `data.tool_input?.description` æå–ä»»åŠ¡æè¿°
  - **å¯¼è‡´ç»“æœ**ï¼š`TASK_DESCRIPTION` å§‹ç»ˆä¸ºé»˜è®¤å€¼"ä»»åŠ¡"ï¼ŒGemini æ”¶åˆ°çš„ prompt è¿‡äºç®€å•
  - **è§£å†³æ–¹æ¡ˆ**ï¼šä» `transcript_path` è¯»å–å®Œæ•´å¯¹è¯å†å²å¹¶æå–æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡

- **å¯¹è¯ä¸Šä¸‹æ–‡æå–**: å®ç°æ­£ç¡®çš„æ•°æ®æå–é€»è¾‘
  - ä½¿ç”¨ Node.js è§£æ JSONL æ ¼å¼çš„ä¼šè¯å†å²
  - æå–ç”¨æˆ·æ¶ˆæ¯å’ŒåŠ©æ‰‹å“åº”çš„æ–‡æœ¬å†…å®¹
  - æ”¯æŒæ•°ç»„å’Œå­—ç¬¦ä¸²ä¸¤ç§å†…å®¹æ ¼å¼
  - è¿‡æ»¤ç©ºæ¶ˆæ¯å’Œæ— æ•ˆæ•°æ®

- **Gemini Prompt ä¼˜åŒ–**: æ”¹è¿›å‘é€ç»™ Gemini çš„ prompt
  - æä¾›å®é™…çš„å¯¹è¯å†…å®¹è€Œéç©ºæ´çš„"ä»»åŠ¡"
  - åŒ…å«æ˜ç¡®çš„è¾“å‡ºæ ¼å¼è¦æ±‚å’Œç¤ºä¾‹
  - æ¸…æ™°çš„å­—æ•°é™åˆ¶ï¼ˆ5-20 å­—ï¼‰
  - å¢å¼ºçš„ä¸Šä¸‹æ–‡æè¿°

### Changed

- **æ‘˜è¦é•¿åº¦è°ƒæ•´**: å°†æœ€å¤§é•¿åº¦ä» 20 å­—ç¬¦æ‰©å±•åˆ° 50 å­—ç¬¦
  - å…è®¸æ›´è¯¦ç»†çš„ä»»åŠ¡æè¿°
  - è¶…è¿‡ 50 å­—ç¬¦æ—¶è‡ªåŠ¨æˆªæ–­å¹¶æ·»åŠ  `...`

- **é”™è¯¯å¤„ç†å¢å¼º**: æ”¹è¿› Gemini è°ƒç”¨çš„é”™è¯¯å¤„ç†
  - ä½¿ç”¨ `2>&1` æ•è·é”™è¯¯è¾“å‡ºå¹¶è®°å½•åˆ°æ—¥å¿—
  - ä½¿ç”¨ `tee` åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶
  - æ£€æŸ¥ç»“æœé•¿åº¦åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•

- **è¶…æ—¶ç­–ç•¥ä¼˜åŒ–**: è°ƒæ•´ä¸åŒæ¨¡å‹çš„è¶…æ—¶æ—¶é—´
  - flash æ¨¡å‹ï¼š5 ç§’ï¼ˆç¬¦åˆå¿«é€Ÿå“åº”éœ€æ±‚ï¼‰
  - pro æ¨¡å‹ï¼š8 ç§’ï¼ˆç•™å‡ºæ›´å¤šæ—¶é—´ä¿è¯è´¨é‡ï¼‰
  - é»˜è®¤æ¨¡å‹ï¼š5 ç§’

### Technical Details

#### Stop é’©å­çš„å®é™…æ•°æ®æ ¼å¼

```json
{
	"session_id": "abc123",
	"transcript_path": "~/.claude/projects/.../session.jsonl",
	"permission_mode": "default",
	"hook_event_name": "Stop",
	"stop_hook_active": true
}
```

**é‡è¦å‘ç°**ï¼šStop é’©å­**ä¸åŒ…å«** `tool_input`ã€`cwd` æˆ– `conversationMessages` å­—æ®µã€‚

#### å¯¹è¯å†å²æ–‡ä»¶æ ¼å¼

transcript_path æŒ‡å‘çš„ JSONL æ–‡ä»¶æ ¼å¼ï¼š

```jsonl
{"role":"user","content":[{"type":"text","text":"ç”¨æˆ·æ¶ˆæ¯"}]}
{"role":"assistant","content":[{"type":"text","text":"åŠ©æ‰‹å“åº”"}]}
```

#### æ¨¡å‹æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹             | å¹³å‡å“åº”æ—¶é—´ | æ€»ç»“è´¨é‡ | æ¨èåœºæ™¯               |
| ---------------- | ------------ | -------- | ---------------------- |
| gemini-2.5-flash | 1-3 ç§’       | è‰¯å¥½     | å¿«é€Ÿé€šçŸ¥ï¼Œç®€å•ä»»åŠ¡     |
| gemini-2.5-pro   | 3-6 ç§’       | ä¼˜ç§€     | å¤æ‚ä»»åŠ¡ï¼Œéœ€è¦ç²¾å‡†è¡¨è¾¾ |

**å®æ–½ç­–ç•¥**ï¼šä¼˜å…ˆä½¿ç”¨ flashï¼ˆé€Ÿåº¦ï¼‰ï¼Œå¤±è´¥æ—¶åˆ‡æ¢ proï¼ˆè´¨é‡ï¼‰ï¼Œç¡®ä¿åœ¨ 5-8 ç§’å†…å®Œæˆã€‚

### Breaking Changes

æ— ç ´åæ€§å˜æ›´ã€‚æ‰€æœ‰æ”¹è¿›éƒ½å‘åå…¼å®¹ã€‚

### Migration Guide

æ— éœ€è¿ç§»ã€‚ç°æœ‰ç”¨æˆ·æ›´æ–°åˆ° 0.5.0 åå°†è‡ªåŠ¨äº«å—æ”¹è¿›çš„æ€»ç»“åŠŸèƒ½ã€‚

### Debugging

å¦‚æœé‡åˆ°æ€»ç»“é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

```powershell
# Windows
cd $env:TEMP\claude-code-task-complete-notifier-logs
Get-Content (Get-ChildItem | Sort-Object LastWriteTime -Descending | Select-Object -First 1).FullName

# Linux/Mac
tail -f /tmp/claude-code-task-complete-notifier-logs/$(ls -t /tmp/claude-code-task-complete-notifier-logs | head -1)
```

æ—¥å¿—åŒ…å«ï¼š

1. Hook è¾“å…¥æ•°æ®ï¼ˆå®Œæ•´ JSONï¼‰
2. æå–çš„å¯¹è¯ä¸Šä¸‹æ–‡
3. å‘é€ç»™ Gemini çš„ prompt
4. Gemini çš„åŸå§‹å“åº”
5. æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
6. æœ€ç»ˆé€šçŸ¥ç»“æœ

### References

- è¯¦ç»†è¯´æ˜ï¼š[scripts/TASK_COMPLETE_NOTIFIER_README.md](./scripts/TASK_COMPLETE_NOTIFIER_README.md)
- å®˜æ–¹æ–‡æ¡£ï¼š[Claude Code Hooks Reference](https://docs.claude.com/en/docs/claude-code/hooks)

## [0.4.1] - 2025-11-03

### Fixed

- **é’©å­é‡å¤æ‰§è¡Œé—®é¢˜**: ä¿®å¤äº†æ’ä»¶é’©å­é‡å¤è¿è¡Œä¸¤æ¬¡çš„ä¸¥é‡ bug
  - é—®é¢˜åŸå› ï¼š`plugin.json` ä¸­ `hooks` å­—æ®µä½¿ç”¨äº†ä¸å—æ”¯æŒçš„æ•°ç»„æ ¼å¼ `["./hooks/hooks.json"]`
  - ä¿®å¤æ–¹æ¡ˆï¼šå°† `hooks` å­—æ®µæ”¹ä¸ºå®˜æ–¹æ”¯æŒçš„å­—ç¬¦ä¸²æ ¼å¼ `"./hooks/hooks.json"`
  - å½±å“èŒƒå›´ï¼šæ‰€æœ‰é’©å­äº‹ä»¶ï¼ˆSessionStartã€UserPromptSubmitã€PreToolUseã€PostToolUseã€Stopã€SessionEndã€SubagentStopï¼‰
  - å‚è€ƒæ–‡æ¡£ï¼š[Claude Code æ’ä»¶å‚è€ƒæ–‡æ¡£ - hooks å­—æ®µå®šä¹‰](https://docs.claude.com/en/docs/claude-code/plugins-reference.md)
  - è¯¦ç»†åˆ†æï¼šå‚è§ `docs/reports/claude-code-hooks-duplicate-execution-issue.md`

### Technical Details

ä¿®å¤å‰çš„é…ç½®ï¼š

```json
{
	"hooks": ["./hooks/hooks.json"] // âŒ ä¸æ”¯æŒçš„æ•°ç»„æ ¼å¼
}
```

ä¿®å¤åçš„é…ç½®ï¼š

```json
{
	"hooks": "./hooks/hooks.json" // âœ… æ­£ç¡®çš„å­—ç¬¦ä¸²æ ¼å¼
}
```

**å½±å“**ï¼šä¿®å¤åï¼Œæ¯ä¸ªé’©å­äº‹ä»¶åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè§£å†³äº†ä¹‹å‰å‡ºç°çš„ `Running PostToolUse hooksâ€¦ (1/2 done)` çš„é—®é¢˜ã€‚

## [0.4.0] - 2025-11-03

### Added

- **å®Œæ•´é’©å­ç³»ç»Ÿ**: å®ç°äº†åŸºäº Claude Code å„ä¸ªé’©å­äº‹ä»¶çš„é€šçŸ¥ç³»ç»Ÿ
  - `Stop`: ä»»åŠ¡å®Œæˆæ—¶è§¦å‘é€šçŸ¥ï¼Œæ”¯æŒ Gemini AI æ™ºèƒ½ç”Ÿæˆä»»åŠ¡æ‘˜è¦
  - `SessionStart`: ä¼šè¯å¼€å§‹æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `SessionEnd`: ä¼šè¯ç»“æŸæ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `UserPromptSubmit`: ç”¨æˆ·æäº¤æ¶ˆæ¯æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `PreToolUse`: å·¥å…·ä½¿ç”¨å‰çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `PostToolUse`: å·¥å…·ä½¿ç”¨åçš„å®šæ—¶æ£€æŸ¥é€šçŸ¥
  - `SubagentStop`: å­ä»£ç†åœæ­¢æ—¶çš„å®šæ—¶æ£€æŸ¥é€šçŸ¥

- **é€šçŸ¥åŠŸèƒ½**: é›†æˆ `@ruan-cat/claude-notifier` åŒ…æä¾›é€šçŸ¥èƒ½åŠ›
  - `task-complete`: ä»»åŠ¡å®Œæˆé€šçŸ¥
  - `check-and-notify`: å®šæ—¶æ£€æŸ¥å¹¶å‘é€é€šçŸ¥
  - æ”¯æŒ Gemini AI æ™ºèƒ½æ€»ç»“ä»»åŠ¡å†…å®¹

- **è„šæœ¬æ”¯æŒ**: æ–°å¢ `task-complete-notifier.sh` è„šæœ¬
  - ä½¿ç”¨ç¯å¢ƒå˜é‡ `CLAUDE_PLUGIN_ROOT` å®šä½æ’ä»¶ç›®å½•
  - æä¾›æ›´çµæ´»çš„é€šçŸ¥è§¦å‘æœºåˆ¶

### Changed

- å°†æ‰€æœ‰é€šçŸ¥é’©å­æ•´åˆåˆ° `Stop` äº‹ä»¶ä¸­ï¼Œç»Ÿä¸€ç®¡ç†

### Fixed

- ä¿®å¤äº† `task-complete-notifier.sh` è„šæœ¬ç¼ºå¤± `CLAUDE_PROJECT_DIR` ç¯å¢ƒå˜é‡çš„é—®é¢˜

## Previous Versions

### [0.3.x] - 2025-10-22 ~ 2025-11-01

æ—©æœŸç‰ˆæœ¬åŒ…å«äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **Commands**:
  - `markdown-title-order`: è®¾ç½®å¹¶ç»´æŠ¤ Markdown æ–‡æ¡£çš„æ ‡é¢˜åºå·
  - `close-window-port`: å…³é—­æŒ‡å®šç«¯å£çš„çª—å£è¿›ç¨‹

- **Agents**:
  - `format-markdown`: æ ¼å¼åŒ– Markdown æ–‡æ¡£çš„ä¸“ç”¨å­ä»£ç†

- **æ’ä»¶æ¶æ„**: åŸºäº [claude-code-marketplace](https://github.com/ananddtyagi/claude-code-marketplace) çš„ä»£ç ç»“æ„è®¾è®¡

---

## ç»´æŠ¤è¯´æ˜

### æŠ¥å‘Šé—®é¢˜

å¦‚æœæ‚¨åœ¨ä½¿ç”¨æ’ä»¶æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹è¯¦ç»†çš„é—®é¢˜åˆ†ææŠ¥å‘Šï¼š`docs/reports/claude-code-hooks-duplicate-execution-issue.md`
2. åœ¨ GitHub ä»“åº“æäº¤ Issueï¼š[ruan-cat/monorepo](https://github.com/ruan-cat/monorepo/issues)

### ç‰ˆæœ¬å‡çº§

æœ¬æ’ä»¶éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼š

- **Major (x.0.0)**: ç ´åæ€§å˜æ›´
- **Minor (0.x.0)**: æ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- **Patch (0.0.x)**: Bug ä¿®å¤ï¼Œå‘åå…¼å®¹

### æ›´æ–°æ’ä»¶

å¦‚æœæ‚¨å·²å®‰è£…æ­¤æ’ä»¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```bash
# æ›´æ–°æ’ä»¶å¸‚åœº
/plugin marketplace update ruan-cat/monorepo

# æˆ–é‡æ–°å®‰è£…æ’ä»¶
/plugin uninstall common-tools
/plugin install common-tools@ruan-cat-tools
```

---

**ç»´æŠ¤è€…**: ruan-cat (1219043956@qq.com)

**ä»“åº“**: [https://github.com/ruan-cat/monorepo](https://github.com/ruan-cat/monorepo)

**è®¸å¯è¯**: MIT
