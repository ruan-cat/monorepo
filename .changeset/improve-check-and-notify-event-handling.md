---
"@ruan-cat/claude-notifier": minor
---

改进 `check-and-notify` 命令的事件处理和日志功能

## 新增功能

### 事件处理增强

- 新增 **SessionStart 事件**处理：跳过通知，避免会话启动时的干扰，立即返回不执行后续逻辑
- 新增 **SessionEnd 事件**处理：删除任务并清理资源，不发送通知，确保会话结束时正确清理任务数据
- 改进 **UserPromptSubmit 事件**处理：无条件删除旧任务并创建新任务，确保每次用户输入都重新计时

### 日志和性能监控

- 新增详细的日志记录系统：
  - 日志文件保存在临时目录 `%TEMP%\claude-notifier-debug\`
  - 每次执行创建独立的日志文件 `check-and-notify-{timestamp}.log`
  - 日志包含时间戳、执行耗时、各阶段详细信息
- 新增性能监控功能：
  - 记录 stdin 读取、任务清理、通知检查等各阶段的耗时
  - 输出总执行时间和各阶段耗时统计
  - 当总耗时接近或超过 5 秒时自动发出警告
- 改进 `--verbose` 选项：同时输出到控制台和日志文件

## 文档更新

- 更新 README.md，补充 SessionStart 和 SessionEnd 事件的说明
- 更新 CLI 使用文档，新增日志功能和性能监控的详细说明
- 更新工作机制说明，完善所有事件的处理流程

## 技术改进

- 优化事件处理逻辑，根据不同的 `hook_event_name` 智能执行相应操作
- 改进注释文档，提供更清晰的函数说明和参数描述
- 增强错误处理和日志记录，便于调试和问题排查
